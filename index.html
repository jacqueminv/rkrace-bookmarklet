<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rkrace-bookmarklet by jacqueminv</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style>
      #bk {
        display: block;
        height: 3em;
        text-align: center;
        padding: 1.5em 0 0;
        margin: 0 0 1em;
        background-color: #eee;
        border-radius: 1em;
      }

      ins {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>RKrace-bookmarklet</h1>
        <p>Edit a race map on Runkeeper simply by droping a gpx file.</p>

        <p class="view"><a href="https://github.com/jacqueminv/rkrace-bookmarklet">View the Project on GitHub <small>jacqueminv/rkrace-bookmarklet</small></a></p>

      </header>
      <section>
        <h3>Editing a race map, one click away</h3>

        <p>Being a fan of Runkeeper since a while I was annoyed by their race map creation workflow. You have to provide the race map and this is possible only by manually setting points. This can take minutes if not hours for some races and it can be hard to be precise (e.g. trail races anybody?).</p>

        <p>The little hacker deep inside me kept urging me to have a try fixing this. Here comes my bookmarklet.</p>

        <p>Drag and drop the following link in your bookmarks. Next time you want to edit a race on Runkeeper, simply click this bookmark and a small box asking you to provide a <code>gpx</code> file will appear. Drag and drop the race file and the process will start. This can take a while depending on your browser and available resources as everything is done in the browser. Nothing is sent or tracked from this bookmarklet. The code is open feel free to check.</p>

        <p>Note this was purposed for race maps at first but it actually works for any activity map found on Runkeeper.</p>

        <a id="bk" href="">
          rkrace-bookmarklet
        </a>

        <script>
          function bk(){javascript:(function(e){window.type={none:0};var c=document.createElement("div");c.innerHTML="Drop the gpx race file here.";c.setAttribute("style","font: bold 0.8em Arial; width:13em; padding: 14.5em 0 1em 0; background: url('data:image/png;base64,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') #EAEAEA no-repeat; position: fixed; top: 1em; left: 1em; z-index: 99999; text-align: center;");c.addEventListener("dragover",g,false);c.addEventListener("drop",a,false);document.body.appendChild(c);var b=document.createElement("div"),d=("draggable" in b)||("ondragstart" in b&&"ondrop" in b),i=window.URL||window.webkitURL,h=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,f=function(j){c.innerHTML=j||"";setTimeout(function(){c.parentElement.removeChild(c)},2000)};if(!(d&&i&&h&&Worker&&FileReader)){f("You need a more recent browser");return}if(!window.mapController){f("Either you're not on RK race edition page, or RK made modifications to the code.");return}if(!mapController.model.editable){f("You must edit the race before proceeding.");return}function a(k){k.stopPropagation();k.preventDefault();var n=k.dataTransfer.files,q,p,l,m,j=new FileReader();if(n.length!==1||n[0].size&&n[0].size>5242880){alert("Please give only one file (max size accepted: 5mb)");return}m=function(A){var x,w,v,H,z=0,E,t,r,D,s=0,F,u=0,y,B,C,G=[];x=function(){};x.constants={DOCTYPE_START:"<!DOCTYPE",CDATA_START:"<![CDATA[",CDATA_END:"]]>",COMMENT_START:"<!--",COMMENT_END:"-->",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSE_SELF_TERMINATING:"/>",ENDTAG_OPEN:"</",EQUALS:"=",SQUOTE:"'",DQUOTE:'"',PI_START:"<?",PI_END:"?>",BRACKET_OPEN:"[",BRACKET_CLOSE:"]",TOKENTYPE_BRACKET_OPEN:"bracketOpen",TOKENTYPE_TAG_OPEN:"tagOpen",TOKENTYPE_TAG_CLOSE:"tagClose",TOKENTYPE_ENDTAG_OPEN:"endTagOpen",TOKENTYPE_ENDTAG_CLOSE:"endTagClose",TOKENTYPE_SELF_TERMINATING:"closeTagSelfTerminating",TOKENTYPE_WHITESPACE:"whitespace",TOKENTYPE_ATTRIBUTE:"attribute",TOKENTYPE_QUOTE:"quote",TOKENTYPE_QUOTED:"quotedLiteral",TOKENTYPE_NORMAL:"normal",TOKENTYPE_COMMENT_START:"commentStart",TOKENTYPE_COMMENT_END:"commentEnd",TOKENTYPE_CDATA_START:"cdataStart",TOKENTYPE_CDATA_END:"cdataEnd",TOKENTYPE_PI_START:"piStart",TOKENTYPE_PI_END:"piEnd",TOKENTYPE_DOCTYPE_START:"docTypeStart",DATATYPE_ATTRIBUTE:"marknote.Attribute",DATATYPE_CDATA:"marknote.CDATA",DATATYPE_CLONER:"marknote.Cloner",DATATYPE_COMMENT:"marknote.Comment",DATATYPE_DOCTYPE:"marknote.DOCTYPE",DATATYPE_DOCUMENT:"marknote.Document",DATATYPE_ELEMENT:"marknote.Element",DATATYPE_ENTITYREF:"marknote.EntityRef",DATATYPE_XMLENTITYREFS:"marknote.XMLEntityRefs",DATATYPE_ENTITYREFS:"marknote.EntityRefs",DATATYPE_PARSER:"marknote.Parser",DATATYPE_PROCESSINGINSTRUCTION:"marknote.ProcessingInstruction",DATATYPE_QNAME:"marknote.QName",DATATYPE_TEXT:"marknote.Text",DATATYPE_TOKEN:"marknote.Token",DATATYPE_TOKENIZER:"marknote.Tokenizer",DATATYPE_WRITER:"marknote.Writer"};x.ajaxDoc=null;x.AJAX=function(){this.req=null;this.status=null;this.statusText=null;this.responseText=null};x.AJAX.prototype.genRequest=function(){var K=false;try{K=new XMLHttpRequest()}catch(L){try{K=new ActiveXObject("Msxml2.XMLHTTP")}catch(I){try{K=new ActiveXObject("Microsoft.XMLHTTP")}catch(J){K=false}}}this.req=K;return K};x.AJAX.prototype.getRequest=function(){return this.req};x.AJAX.prototype.getStatus=function(){return this.status};x.AJAX.prototype.getStatusText=function(){return this.statusText};x.AJAX.prototype.getResponseText=function(){return this.responseText};x.AJAX.prototype.constructQueryString=function(K){var L="";if(K&&typeof K=="object"){var J="";for(var I in K){L+=J+encodeURIComponent(I)+"="+encodeURIComponent(K[I]);J="&"}}else{if(K&&typeof K=="string"){L=K}}return L};x.AJAX.prototype.read=function(P,O,J,M,Q){var L=this.genRequest();var I=this;var N=this.constructQueryString(O);var K;x.AJAXDoc=null;Q=Q&&Q.toUpperCase()==="POST"?"POST":"GET";if(!L){return false}if(!J){J=x.AJAX.defaultCallback}if(!M){M=new Object()}L.open(Q,P,true);L.setRequestHeader("Content-Type","application/x-www-form-urlencoded");L.onreadystatechange=function(){if(L.readyState==4){I.status=L.status;I.statusText=L.statusText;I.responseText=L.responseText;var R=new x.Parser();K=R.parse(L.responseText);J.call(I,K,M)}};L.send(N)};x.AJAX.prototype.defaultCallback=function(J,I){x.AJAXDoc=J};x.SJAX=function(){this.req=null;this.status=null;this.statusText=null;this.responseText=null};x.SJAX.prototype.getRequest=function(){return this.req};x.SJAX.prototype.getStatus=function(){return this.status};x.SJAX.prototype.getStatusText=function(){return this.statusText};x.SJAX.prototype.getResponseText=function(){return this.responseText};x.SJAX.prototype.read=function(J,M,K){var N=new x.AJAX();var I=N.genRequest();var O=N.constructQueryString(M);var L=new x.Parser();K=K&&K.toUpperCase()==="POST"?"POST":"GET";if(!I){return new x.Document()}I.open(K,J,false);I.setRequestHeader("Content-Type","application/x-www-form-urlencoded");I.send(O);this.req=I;this.status=I.status;this.statusText=I.statusText;this.responseText=I.responseText;return L.parse(I.responseText)};x.Attribute=function(J,I){this.dataType=x.constants.DATATYPE_ATTRIBUTE;this.isSw8tXmlContent=false;this.name=J;this.value=x.Util.erefEncode(x.Util.nothingToBlank(I))};x.Attribute.prototype.getName=function(){return this.name};x.Attribute.prototype.setName=function(I){this.name=I};x.Attribute.prototype.getValue=function(){return x.Util.erefDecode(x.Util.nothingToBlank(this.value))};x.Attribute.prototype.setValue=function(I){this.value=x.Util.erefEncode(x.Util.nothingToBlank(I))};x.Attribute.prototype.toString=function(){return this.getName()+'="'+this.getValue()+'"'};x.Attribute.prototype.clone=function(){return new x.Attribute(this.getName(),this.getValue())};x.CDATA=function(I){this.dataType=x.constants.DATATYPE_CDATA;this.isSw8tXmlContent=true;this.text=x.Util.nothingToBlank(I)};x.CDATA.prototype.getText=function(){return x.Util.nothingToBlank(this.text)};x.CDATA.prototype.setText=function(I){this.text=x.Util.nothingToBlank(I)};x.CDATA.prototype.toString=function(){return this.getText()};x.CDATA.prototype.clone=function(){var I=new x.Cloner();return I.clone(this)};x.Cloner=function(){this.dataType=x.constants.DATATYPE_CLONER;this.isSw8tXmlContent=false};x.Cloner.prototype.cloneDocument=function(L){var N=new x.Document();var K=L.getProcessingInstructions();var J=L.getRootElement();var O;for(var M=0;M<K.length;M++){O=this.cloneProcessingInstruction(K[M]);N.addProcessingInstruction(O)}var I=this.cloneElement(J);N.setRootElement(I);return N};x.Cloner.prototype.cloneProcessingInstruction=function(K){var I=K.getData();var J=K.getTarget().slice(0);var L=this.cloneArray(I);return new x.ProcessingInstruction(J,L)};x.Cloner.prototype.cloneElement=function(M){var L=new x.Element();var J=M.getName().slice(0);var I=this.cloneArray(M.getAttributes());L.setName(J);L.setAttributes(I);if(M.isSelfTerminated){L.isSelfTerminated=true;return L}var K=this.cloneContents(M);L.setContents(K);return L};x.Cloner.prototype.cloneContents=function(M){var L=new Array();var I,J;for(var K=0;K<M.getContents().length;K++){var N=M.getContentAt(K);J=x.Util.dataType(N);switch(J){case x.constants.DATATYPE_ELEMENT:I=this.cloneElement(N);L.push(I);break;default:I=this.clone(N);L.push(I);break}}return L};x.Cloner.prototype.clone=function(K){var J=(K.dataType&&K.dataType.indexOf("marknote.")>0)||typeof K=="object";if(!J){return K}var L=new Object();for(var I in K){L[I]=this.clone(K[I])}return L};x.Cloner.prototype.cloneArray=function(L){var I=new Array();var K;for(var J=0;J<L.length;J++){K=this.clone(L[J]);I.push(K)}return I};x.Comment=function(I){this.dataType=x.constants.DATATYPE_COMMENT;this.isSw8tXmlContent=true;this.text=x.Util.erefEncode(x.Util.nothingToBlank(I))};x.Comment.prototype.getText=function(){return x.Util.erefDecode(x.Util.nothingToBlank(this.text))};x.Comment.prototype.setText=function(I){this.text=x.Util.erefEncode(x.Util.nothingToBlank(I))};x.Comment.prototype.toString=function(){return this.getText()};x.Comment.prototype.clone=function(){var I=new x.Cloner();return I.clone(this)};x.FPI=function(M,I,K,J,L){this.registration=M;this.organization=I;this.publicTextClass=K;this.publicTextDescription=J;this.publicTextLanguage=L};x.FPI.prototype.toString=function(){return'"'+this.getRegistration()+"//"+this.getOrganization()+"//"+this.getPublicTextClass()+" "+this.getPublicTextDescription()+"//"+this.getPublicTextLanguage()+'"'};x.FPI.prototype.getRegistration=function(){return this.registration};x.FPI.prototype.setRegistration=function(I){this.registration=I};x.FPI.prototype.getOrganization=function(){return this.organization};x.FPI.prototype.setOrganization=function(I){this.organziation=I};x.FPI.prototype.getPublicTextClass=function(){return this.publicTextClass};x.FPI.prototype.setPublicTextClass=function(I){this.publicTextClass=I};x.FPI.prototype.getPublicTextDescription=function(){return this.publicTextDescription};x.FPI.prototype.setPublicTextDescription=function(I){this.publicTextDescription=I};x.FPI.prototype.getPublicTextLanguage=function(){return this.publicTextLanguage};x.FPI.prototype.setPublicTextLanguage=function(I){this.publicTextLanguage=I};x.DOCTYPE=function(K,N,P,J,O){this.dataType=x.constants.DATATYPE_DOCTYPE;this.isSw8tXmlContent=false;if(K&&!N){var M=new String(K);var L=new x.Parser();var I=L.parseDOCTYPE(M);this.topElement=I.getTopElement();this.availability=I.getAvailability();this.FPI=I.getFPI();this.URL=I.getURL();this.internalSubset=I.getInternalSubset()}else{this.setTopElement(K);this.setAvailability(N);this.setFPI(P);this.setURL(J);this.setInternalSubset(O)}};x.DOCTYPE.prototype.toString=function(){var K=this.getAvailability()=="PUBLIC"&&this.getFPI()?" "+this.getFPI():"";var J=this.getURL()?" "+this.getURL():"";var I=this.getInternalSubset()?" "+this.getInternalSubset():"";return"<!DOCTYPE "+this.getTopElement()+" "+this.getAvailability()+K+J+I+">"};x.DOCTYPE.prototype.getTopElement=function(){return this.topElement};x.DOCTYPE.prototype.setTopElement=function(I){this.topElement=I};x.DOCTYPE.prototype.getAvailability=function(){return this.availability};x.DOCTYPE.prototype.setAvailability=function(I){this.availability=I};x.DOCTYPE.prototype.getFPI=function(){return this.FPI};x.DOCTYPE.prototype.setFPI=function(I){this.FPI=I};x.DOCTYPE.prototype.getURL=function(){return this.URL};x.DOCTYPE.prototype.setURL=function(J){var I=x.Util.trim(J);if(I===""){this.URL="";return}if(I.charAt(0)!='"'){I='"'+I}if(I.charAt(I.length-1)!='"'){I+='"'}this.URL=I};x.DOCTYPE.prototype.getInternalSubset=function(){return this.internalSubset};x.DOCTYPE.prototype.setInternalSubset=function(I){this.dataType=x.constants.DATATYPE_DOCTYPE;this.internalSubset=I};x.Document=function(){this.dataType=x.constants.DATATYPE_DOCUMENT;this.isSw8tXmlContent=false;this.processingInstructions=new Array();this.rootElement=new x.Element();this.contents=new Array()};x.Document.prototype.getProcessingInstructions=function(){return this.processingInstructions};x.Document.prototype.setProcessingInstructions=function(I){this.processingInstructions=I};x.Document.prototype.addProcessingInstruction=function(I){this.processingInstructions.push(I)};x.Document.prototype.removeProcessingInstruction=function(K){for(var I=0;I<this.processingInstructions.length;I++){var J=this.processingInstructions[I].getTarget();if(J==K){x.Util.removeArrayItem(this.processingInstructions,I)}}};x.Document.prototype.getRootElement=function(){return this.rootElement};x.Document.prototype.setRootElement=function(I){if(!(I instanceof x.Element)){return}this.rootElement=I};x.Document.prototype.getDOCTYPE=function(){return this.DOCTYPE};x.Document.prototype.setDOCTYPE=function(I){this.DOCTYPE=I};x.Document.prototype.getBaseURI=function(){return this.baseURI};x.Document.prototype.setBaseURI=function(I){this.baseURI=I};x.Document.prototype.toString=function(J,I,K,L){var M=new x.Writer();return M.outputDocument(this,J)};x.Document.prototype.clone=function(){var I=new x.Cloner();return I.cloneDocument(this)};x.Element=function(I){this.dataType=x.constants.DATATYPE_ELEMENT;this.isSw8tXmlContent=true;this.contents=new Array();this.attributes=new Array();this.qname=new x.QName();this.isSelfTerminated=false;if(I){if(I instanceof x.QName){this.setQName(I)}else{this.setName(I)}}};x.Element.prototype.getName=function(){return this.qname.getName()};x.Element.prototype.setName=function(I){this.qname.setName(I)};x.Element.prototype.getQName=function(){return this.qname};x.Element.prototype.setQName=function(I){this.qname=I};x.Element.prototype.hasContents=function(){return this.contents&&this.contents.length>0};x.Element.prototype.getContents=function(){return this.contents};x.Element.prototype.getContentAt=function(I){return this.getContents()[I]};x.Element.prototype.addContent=function(I){if(I&&I.isSw8tXmlContent){this.getContents().push(I)}};x.Element.prototype.removeContent=function(I){x.Util.removeArrayItem(this.contents,I)};x.Element.prototype.setContents=function(I){this.contents=I};x.Element.prototype.getText=function(L){var K="";if(typeof L=="undefined"){L=true}for(var I=0;I<this.contents.length;I++){var M=this.getContentAt(I);var J=x.Util.dataType(M);if(J==x.constants.DATATYPE_TEXT){K+=M.getText(L)}else{if(J==x.constants.DATATYPE_CDATA){K+=M.getText()}}}return K};x.Element.prototype.setText=function(K){var J=new Array();for(var M=0;M<this.contents.length;M++){var L=this.getContentAt(M);var I=x.Util.dataType(L);if(I==x.constants.DATATYPE_COMMENT){J.push(L)}}this.contents=J;K=K?""+K:"";this.contents.push(new x.Text(K))};x.Element.prototype.setCDATAText=function(K){var J=new Array();for(var M=0;M<this.contents.length;M++){var L=this.getContentAt(M);var I=x.Util.dataType(L);if(I==x.constants.DATATYPE_COMMENT){J.push(L)}}this.contents=J;K=K?""+K:"";this.contents.push(new x.CDATA(K))};x.Element.prototype.removeText=function(){for(var I=this.contents.length-1;I>=0;I--){var K=this.getContentAt(I);var J=x.Util.dataType(K);if(J==x.constants.DATATYPE_TEXT||J==x.constants.DATATYPE_CDATA){x.Util.removeArrayItem(this.contents,I)}}};x.Element.prototype.getCommentText=function(){var K="";for(var I=0;I<this.contents.length;I++){var L=this.getContentAt(I);var J=x.Util.dataType(L);if(J==x.constants.DATATYPE_COMMENT){K+=L.getText()}}return K};x.Element.prototype.setCommentText=function(I){this.removeComments();I=I?""+I:"";this.addContent(new x.Comment(I))};x.Element.prototype.removeComments=function(){for(var I=this.contents.length-1;I>=0;I--){var K=this.getContentAt(I);var J=x.Util.dataType(K);if(J==x.constants.DATATYPE_COMMENT){x.Util.removeArrayItem(this.contents,I)}}};x.Element.prototype.addChildElement=function(I){var J=x.Util.dataType(I);if(!J==x.constants.DATATYPE_ELEMENT){return}this.getContents().push(I)};x.Element.prototype.removeChildElements=function(K){var L=0;if(!K){L=this.contents.length;this.contents=new Array();return L}var N=K.dataType==x.constants.DATATYPE_QNAME?K.getName():K;var M=x.Cloner.cloneArray(this.contents);for(var I=M.length-1;I>=0;I--){var J=x.Util.dataType(M[I]);if(J!=x.constants.DATATYPE_ELEMENT){continue}if(this.clonedContents[I].getName()==N){x.Util.removeArrayItem(this.contents,I);L++}}return L};x.Element.prototype.getChildElements=function(L){var N=false;var K=new Array();if(L){N=L.dataType==x.constants.DATATYPE_QNAME?L.getName():L}for(var I=0;I<this.contents.length;I++){var M=this.contents[I];var J=x.Util.dataType(M);if(J!=x.constants.DATATYPE_ELEMENT){continue}if(N){if(M.getName()==N){K.push(M)}}else{K.push(M)}}return K};x.Element.prototype.getChildElement=function(O){var I=O.dataType==x.constants.DATATYPE_QNAME?O.getName():O;if(I){var K=this.getContents();for(var L=0;L<K.length;L++){var M=K[L];var J=x.Util.dataType(M);if(J==x.constants.DATATYPE_ELEMENT){var N=M.getName();if(N===I){return M}}}}};x.Element.prototype.removeChildElement=function(O){var I=O.dataType==x.constants.DATATYPE_QNAME?O.getName():O;if(I){var K=this.getContents();for(var L=0;L<K.length;L++){var M=K[L];var J=x.Util.dataType(M);if(J==x.constants.DATATYPE_ELEMENT){var N=M.getName();if(N===I){x.Util.removeArrayItem(this.contents,L);return}}}}};x.Element.prototype.getChildElementAt=function(J){try{return this.getChildElements()[J]}catch(I){}};x.Element.prototype.removeChildElementAt=function(J){var K=-1;var I;for(var L=0;L<this.contents.length;L++){I=x.Util.dataType(this.contents[L])==x.constants.DATATYPE_ELEMENT;if(I){K++;if(J==K){x.Util.removeArrayItem(this.contents,L);return}}}};x.Element.prototype.getAttributes=function(){return this.attributes};x.Element.prototype.setAttributes=function(I){this.attributes=I};x.Element.prototype.getAttribute=function(J){for(var I=0;I<this.getAttributes().length;I++){var K=this.getAttributes()[I];if(K.getName()==J){return K}}};x.Element.prototype.getAttributeValue=function(J){var I=this.getAttribute(J);return I?I.getValue():""};x.Element.prototype.getAttributeAt=function(I){return this.getAttributes()[I]};x.Element.prototype.setAttribute=function(J,K){if(x.Util.dataType(J)==x.constants.DATATYPE_ATTRIBUTE){this.putAttribute(J)}else{for(var I=0;I<this.getAttributes().length;I++){var L=this.getAttributes()[I];if(L.getName()==J){L.setValue(K);return}}this.putAttribute(new x.Attribute(J,K))}};x.Element.prototype.putAttribute=function(I){if(I&&this.getAttribute(I.getName())){this.removeAttribute(I.getName())}this.getAttributes().push(I)};x.Element.prototype.removeAttribute=function(J){var K=new Array();for(var I=0;I<this.getAttributes().length;I++){var L=this.getAttributes()[I];if(L.getName()!=J){K.push(L)}}this.setAttributes(K)};x.Element.prototype.removeAllAttributes=function(){this.setAttributes(new Array())};x.Element.prototype.toString=function(J){var I=new x.Writer();return I.outputElement(this,0,J)};x.Element.prototype.clone=function(){var I=new x.Cloner();return I.cloneElement(this)};x.EntityRef=function(J,I){this.dataType=x.constants.DATATYPE_ENTITYREF;this.name=J;this.character=I};x.EntityRef.prototype.getName=function(){return this.name};x.EntityRef.prototype.setName=function(I){this.name=I};x.EntityRef.prototype.getName=function(){return this.name};x.EntityRef.prototype.setName=function(I){this.dataType=x.constants.DATATYPE_ENTITYREF;this.isSw8tXmlContent=false;this.character=I};x.EntityRef.prototype.clone=function(){var I=new x.Cloner();return I.clone(this)};x.XMLEntityRefs=function(){this.dataType=x.constants.DATATYPE_XMLENTITYREFS;this.isSw8tXmlContent=false;this.refs=new Array();this.pushRef("quot",34);this.pushRef("amp",38);this.pushRef("apos",39);this.pushRef("lt",60);this.pushRef("gt",62)};x.XMLEntityRefs.prototype.getRefs=function(){return this.refs};x.XMLEntityRefs.prototype.pushRef=function(I,J){this.refs.push(new x.EntityRef(I,String.fromCharCode(J)))};x.EntityRefs=function(){this.dataType=x.constants.DATATYPE_ENTITYREFS;this.isSw8tXmlContent=false;this.refs=new Array().concat(new x.XMLEntityRefs().getRefs());this.pushRef("nbsp",160);this.pushRef("iexcl",161);this.pushRef("cent",162);this.pushRef("pound",163);this.pushRef("curren",164);this.pushRef("yen",165);this.pushRef("brvbar",166);this.pushRef("sect",167);this.pushRef("uml",168);this.pushRef("copy",169);this.pushRef("ordf",170);this.pushRef("laquo",171);this.pushRef("not",172);this.pushRef("shy",173);this.pushRef("reg",174);this.pushRef("macr",175);this.pushRef("deg",176);this.pushRef("plusmn",177);this.pushRef("sup2",178);this.pushRef("sup3",179);this.pushRef("acute",180);this.pushRef("micro",181);this.pushRef("para",182);this.pushRef("middot",183);this.pushRef("cedil",184);this.pushRef("sup1",185);this.pushRef("ordm",186);this.pushRef("raquo",187);this.pushRef("frac14",188);this.pushRef("frac12",189);this.pushRef("frac34",190);this.pushRef("iquest",191);this.pushRef("Agrave",192);this.pushRef("Aacute",193);this.pushRef("Acirc",194);this.pushRef("Atilde",195);this.pushRef("Auml",196);this.pushRef("Aring",197);this.pushRef("AElig",198);this.pushRef("Ccedil",199);this.pushRef("Egrave",200);this.pushRef("Eacute",201);this.pushRef("Ecirc",202);this.pushRef("Euml",203);this.pushRef("Igrave",204);this.pushRef("Iacute",205);this.pushRef("Icirc",206);this.pushRef("Iuml",207);this.pushRef("ETH",208);this.pushRef("Ntilde",209);this.pushRef("Ograve",210);this.pushRef("Oacute",211);this.pushRef("Ocirc",212);this.pushRef("Otilde",213);this.pushRef("Ouml",214);this.pushRef("times",215);this.pushRef("Oslash",216);this.pushRef("Ugrave",217);this.pushRef("Uacute",218);this.pushRef("Ucirc",219);this.pushRef("Uuml",220);this.pushRef("Yacute",221);this.pushRef("THORN",222);this.pushRef("szlig",223);this.pushRef("agrave",224);this.pushRef("aacute",225);this.pushRef("acirc",226);this.pushRef("atilde",227);this.pushRef("auml",228);this.pushRef("aring",229);this.pushRef("aelig",230);this.pushRef("ccedil",231);this.pushRef("egrave",232);this.pushRef("eacute",233);this.pushRef("ecirc",234);this.pushRef("euml",235);this.pushRef("igrave",236);this.pushRef("iacute",237);this.pushRef("icirc",238);this.pushRef("iuml",239);this.pushRef("eth",240);this.pushRef("ntilde",241);this.pushRef("ograve",242);this.pushRef("oacute",243);this.pushRef("ocirc",244);this.pushRef("otilde",245);this.pushRef("ouml",246);this.pushRef("divide",247);this.pushRef("oslash",248);this.pushRef("ugrave",249);this.pushRef("uacute",250);this.pushRef("ucirc",251);this.pushRef("uuml",252);this.pushRef("yacute",253);this.pushRef("thorn",254);this.pushRef("yuml",255);this.pushRef("OElig",338);this.pushRef("oelig",339);this.pushRef("Scaron",352);this.pushRef("scaron",353);this.pushRef("Yuml",376);this.pushRef("fnof",402);this.pushRef("circ",710);this.pushRef("tilde",732);this.pushRef("Alpha",913);this.pushRef("Beta",914);this.pushRef("Gamma",915);this.pushRef("Delta",916);this.pushRef("Epsilon",917);this.pushRef("Zeta",918);this.pushRef("Eta",919);this.pushRef("Theta",920);this.pushRef("Iota",921);this.pushRef("Kappa",922);this.pushRef("Lambda",923);this.pushRef("Mu",924);this.pushRef("Nu",925);this.pushRef("Xi",926);this.pushRef("Omicron",927);this.pushRef("Pi",928);this.pushRef("Rho",929);this.pushRef("Sigma",931);this.pushRef("Tau",932);this.pushRef("Upsilon",933);this.pushRef("Phi",934);this.pushRef("Chi",935);this.pushRef("Psi",936);this.pushRef("Omega",937);this.pushRef("alpha",945);this.pushRef("beta",946);this.pushRef("gamma",947);this.pushRef("delta",948);this.pushRef("epsilon",949);this.pushRef("zeta",950);this.pushRef("eta",951);this.pushRef("theta",952);this.pushRef("iota",953);this.pushRef("kappa",954);this.pushRef("lambda",955);this.pushRef("mu",956);this.pushRef("nu",957);this.pushRef("xi",958);this.pushRef("omicron",959);this.pushRef("pi",960);this.pushRef("rho",961);this.pushRef("sigmaf",962);this.pushRef("sigma",963);this.pushRef("tau",964);this.pushRef("upsilon",965);this.pushRef("phi",966);this.pushRef("chi",967);this.pushRef("psi",968);this.pushRef("omega",969);this.pushRef("thetasym",977);this.pushRef("upish",978);this.pushRef("piv",982);this.pushRef("ensp",8194);this.pushRef("emsp",8195);this.pushRef("thinsp",8201);this.pushRef("zwnj",8204);this.pushRef("zwj",8205);this.pushRef("lrm",8206);this.pushRef("rlm",8207);this.pushRef("ndash",8211);this.pushRef("mdash",8212);this.pushRef("lsquo",8216);this.pushRef("rsquo",8217);this.pushRef("sbquo",8218);this.pushRef("ldquo",8220);this.pushRef("rdquo",8221);this.pushRef("bdquo",8222);this.pushRef("dagger",8224);this.pushRef("Dagger",8225);this.pushRef("bull",8226);this.pushRef("hellip",8230);this.pushRef("permil",8240);this.pushRef("prime",8242);this.pushRef("Prime",8243);this.pushRef("lsaquo",8249);this.pushRef("rsaquo",8250);this.pushRef("oline",8254);this.pushRef("frasl",8260);this.pushRef("euro",8364);this.pushRef("image",8465);this.pushRef("weierp",8472);this.pushRef("real",8476);this.pushRef("trade",8482);this.pushRef("alefsym",8501);this.pushRef("larr",8592);this.pushRef("uarr",8593);this.pushRef("rarr",8594);this.pushRef("darr",8595);this.pushRef("harr",8596);this.pushRef("crarr",8629);this.pushRef("lArr",8656);this.pushRef("uArr",8657);this.pushRef("rArr",8658);this.pushRef("dArr",8659);this.pushRef("hArr",8660);this.pushRef("forall",8704);this.pushRef("part",8706);this.pushRef("exist",8707);this.pushRef("empty",8709);this.pushRef("nabla",8711);this.pushRef("isin",8712);this.pushRef("notin",8713);this.pushRef("ni",8715);this.pushRef("prod",8719);this.pushRef("sum",8721);this.pushRef("minus",8722);this.pushRef("lowast",8727);this.pushRef("radic",8730);this.pushRef("prop",8733);this.pushRef("infin",8734);this.pushRef("ang",8736);this.pushRef("and",8743);this.pushRef("or",8744);this.pushRef("cap",8745);this.pushRef("cup",8746);this.pushRef("int",8747);this.pushRef("there4",8756);this.pushRef("sim",8764);this.pushRef("cong",8773);this.pushRef("asymp",8776);this.pushRef("ne",8800);this.pushRef("equiv",8801);this.pushRef("le",8804);this.pushRef("ge",8805);this.pushRef("sub",8834);this.pushRef("sup",8835);this.pushRef("nsub",8836);this.pushRef("sube",8838);this.pushRef("supe",8839);this.pushRef("oplus",8853);this.pushRef("otimes",8855);this.pushRef("perp",8869);this.pushRef("sdot",8901);this.pushRef("lceil",8968);this.pushRef("rceil",8969);this.pushRef("lfloor",8970);this.pushRef("rfloor",8971);this.pushRef("lang",9001);this.pushRef("rang",9002);this.pushRef("loz",9674);this.pushRef("spades",9824);this.pushRef("clubs",9827);this.pushRef("hearts",9829);this.pushRef("diams",9830)};x.EntityRefs.prototype.getRefs=function(){return this.refs};x.EntityRefs.prototype.pushRef=function(I,J){this.refs.push(new x.EntityRef(I,String.fromCharCode(J)))};x.Parser=function(){this.dataType=x.constants.DATATYPE_PARSER;this.isSw8tXmlContent=false;this.doc=new x.Document();this.status=0;this.statusMessage="success";this.xhr=null;this.xhrStatus=null;this.xhrStatusText=null;this.xhrResponseText=null};x.Parser.prototype.getDocument=function(){return this.doc};x.Parser.prototype.getXHR=function(){return this.xhr};x.Parser.prototype.getXHRStatus=function(){return this.xhrStatus};x.Parser.prototype.getXHRStatusText=function(){return this.xhrStatusText};x.Parser.prototype.getXHRResponseText=function(){return this.xhrResponseText};x.Parser.prototype.getStatus=function(){return this.status};x.Parser.prototype.setStatus=function(I){this.status=I};x.Parser.prototype.getStatusMessage=function(){return this.statusMessage};x.Parser.prototype.setStatusMessage=function(I){this.statusMessage=I};x.Parser.prototype.parseProcessingInstructions=function(O,L){var J=new x.Tokenizer(O);var N=J.tokenize();var S=0,W=0;var X=false;var R,P,T,Q,Y,M,K;for(var I=0;I<N.length;I++){K=N[I].getType();switch(K){case x.constants.TOKENTYPE_PI_START:S=N[I].getPosition();P="";T=new Array();X=true;P=N[I+1].getContent();I++;break;case x.constants.TOKENTYPE_PI_END:if(X){if(x.Util.isUndefinedNullOrBlank(P)){P="xml"}}X=false;W=N[I].getPosition()+2;R=new x.ProcessingInstruction(P,T);L.addProcessingInstruction(R);break;case x.constants.TOKENTYPE_ATTRIBUTE:if(X){Y=N[I-1].getContent();M=N[I+1].getContent();M=M.slice(1,M.length-1);Q=new x.Attribute(Y,M);T.push(Q)}I++;break;default:break}}if(W>S){var U=S>0?O.slice(0,S):"";var V=O.slice(W+1);return x.Util.trim(U+V)}else{return O}};x.Parser.prototype.parseProcessingInstructions=function(O,L){var J=new x.Tokenizer(O);var N=J.tokenize();var S=0,W=0;var X=false;var R,P,T,Q,Y,M,K;for(var I=0;I<N.length;I++){K=N[I].getType();switch(K){case x.constants.TOKENTYPE_PI_START:S=N[I].getPosition();P="";T=new Array();X=true;P=N[I+1].getContent();I++;break;case x.constants.TOKENTYPE_PI_END:if(X){if(x.Util.isUndefinedNullOrBlank(P)){P="xml"}}X=false;W=N[I].getPosition()+2;R=new x.ProcessingInstruction(P,T);L.addProcessingInstruction(R);break;case x.constants.TOKENTYPE_ATTRIBUTE:if(X){Y=N[I-1].getContent();M=N[I+1].getContent();M=M.slice(1,M.length-1);Q=new x.Attribute(Y,M);T.push(Q)}I++;break;default:break}}if(W>S){var U=S>0?O.slice(0,S):"";var V=O.slice(W+1);return x.Util.trim(U+V)}else{return O}};x.Parser.prototype.parseDOCTYPE=function(N,L){var J=new x.Tokenizer(N);var M=J.tokenize();var O=new x.DOCTYPE();var K,P;try{for(var I=0;I<M.length;I++){K=M[I].getType();switch(K){case x.constants.TOKENTYPE_DOCTYPE_START:if(L){L.setDOCTYPE(O)}if(M[++I].isTagClose()){return O}O.setTopElement(M[I].getContent());P=M[++I].getContent().toUpperCase();O.setAvailability(P);if("SYSTEM"==P){if(M[++I].isTagClose()){return O}O.setURL(M[I].getContent())}else{if("PUBLIC"==P){if(M[++I].isTagClose()){return O}O.setFPI(M[I].getContent());if(M[++I].isTagClose()){return O}O.setURL(M[I].getContent());if(M[++I].isTagClose()){return O}O.setInternalSubset(M[I].getContent())}}break;case x.constants.TOKENTYPE_TAG_CLOSE:return O;default:break}}}catch(Q){window.alert(Q)}return O};x.Parser.prototype.parse=function(I){this.xhr=null;this.xhrStatus=null;this.xhrStatusText=null;this.xhrResponseText=null;this.doc=new x.Document();this.setStatus(0);I=this.parseProcessingInstructions(I,this.doc);this.parseDOCTYPE(I,this.doc);this.parseElement(I,this.doc);return this.doc};x.Parser.prototype.parseURL=function(J,L,K){var M=new x.SJAX();var I=M.read(J,L,K);this.xhr=M.getRequest();this.xhrStatus=M.getStatus();this.xhrStatusText=M.getStatusText();this.xhrResponseText=M.getResponseText();return I};x.Parser.prototype.parseComment=function(J,M,I){var L=M[I+1].content==x.constants.COMMENT_START?"":M[I+1].content;var K=new x.Comment(L);if(J){J.addContent(K)}I=M[I+1].content==x.constants.COMMENT_START?I+1:I+2;return I};x.Parser.prototype.parseElement=function(L,I,R){var Q=new x.Tokenizer(L);var T=Q.tokenize();var J=0,aa=0;var N=false;for(var V=0;V<T.length;V++){if(T[V].isCommentStart()){V=this.parseComment(R,T,V);continue}for(;V<T.length;V++){if(T[V].isTagOpen()){J=V;break}}if(J!=V){return}var K=new x.Element(T[J+1].content);if(!R){I.setRootElement(K)}else{R.addContent(K)}for(V=J+1;V<T.length;V++){switch(T[V].getType()){case x.constants.TOKENTYPE_SELF_TERMINATING:K.isSelfTerminated=true;J=V;break;case x.constants.TOKENTYPE_TAG_CLOSE:K.isSelfTerminated=false;J=V;break;case x.constants.TOKENTYPE_ATTRIBUTE:try{var ad=T[V-1].content;var Y=T[V+1].content;var S=Y.slice(1,Y.length-1);var W=new x.Attribute(ad,S);K.putAttribute(W)}catch(Z){}break;default:break}if(J==V){break}}if(!J==V){return}switch(T[J].content){case x.constants.TAG_CLOSE_SELF_TERMINATING:N=T[J+1]&&T[J+1].content==x.constants.COMMENT_START;if(N){aa=J+1;while(N){aa=this.parseComment(R,T,aa);N=T[aa+1]&&T[aa+1].content==x.constants.COMMENT_START;if(N){aa++}}}else{aa=J}break;case x.constants.TAG_CLOSE:if(T[J+1]){if(T[J+1].isCDATAStart()){var U=T[V+2].content;var M=V+3;if(T[V+2].isCDATAEnd()){U="";M=V+2}var ae=new x.CDATA(U);K.addContent(ae);J=M}else{if(T[J+1].isLiteral){K.setText(T[J+1].getContent())}}}else{aa=J}for(V=J+1;V<T.length;V++){var P=T[V].getContent()==x.constants.ENDTAG_OPEN&&T[V+1].getContent()==K.getName()?true:false;if(P){aa=V;N=T[aa+3]&&T[aa+3].content==x.constants.COMMENT_START;if(N){aa=this.parseComment(R,T,aa+3)}var O=aa==J+1||(T[J+1].isLiteral&&aa==J+2)?false:true;if(!O){break}var ab=T[J+1].getPosition();var ac=T[aa].getPosition();var X=L.slice(ab,ac);this.parseElement(X,I,K);break}}if(!P){return}break;default:return}V=aa}};x.ProcessingInstruction=function(I,J){this.dataType=x.constants.DATATYPE_PROCESSINGINSTRUCTION;this.isSw8tXmlContent=false;this.target=I?I:"xml";if(I&&!J){this.data=new Array()}else{if(!J){this.data=[new x.Attribute("version","1.0"),new x.Attribute("encoding","UTF-8")]}else{this.data=J}}};x.ProcessingInstruction.prototype.getData=function(){return this.data};x.ProcessingInstruction.prototype.setData=function(I){this.data=I};x.ProcessingInstruction.prototype.getTarget=function(){return this.target};x.ProcessingInstruction.prototype.setTarget=function(I){this.target=I};x.ProcessingInstruction.prototype.setAttribute=function(K){var J=this.getData();if(x.Util.dataType(K)==x.constants.DATATYPE_ATTRIBUTE){for(var I=0;I<J.length;I++){if(J[I].getName()==K.getName()){J[I].setValue(K.getValue());return}}}};x.ProcessingInstruction.prototype.getAttributeValue=function(K){var J=this.getData();for(var I=0;I<J.length;I++){if(J[I].getName()==K){return J[I]}}};x.ProcessingInstruction.prototype.setAttributeValue=function(L,J){var K=this.getData();if(L){if(typeof J=="undefined"){J=""}for(var I=0;I<K.length;I++){if(K[I].getName()==L){K[I].setValue(J);return}}K.push(new x.Attribute(L,J))}};x.ProcessingInstruction.prototype.clone=function(){var I=new x.Cloner();return I.cloneProcessingInstruction(this)};x.QName=function(I,J){this.dataType=x.constants.DATATYPE_QNAME;this.isSw8tXmlContent=false;this.prefix=x.Util.nothingToBlank(I);this.localPart=x.Util.nothingToBlank(J)};x.QName.prototype.getName=function(){var I="";if(x.Util.hasValue(this.prefix)){I+=this.prefix+":"}if(x.Util.hasValue(this.localPart)){I+=this.localPart}return I};x.QName.prototype.setName=function(I){var K=x.Util.nothingToBlank(I);var J=K.split(":");if(J.length>1){this.prefix=J[0];this.localPart=J[1]}else{this.prefix="";this.localPart=K}};x.QName.prototype.getPrefix=function(){return x.Util.nothingToBlank(this.prefix)};x.QName.prototype.setPrefix=function(I){this.prefix=x.Util.nothingToBlank(I)};x.QName.prototype.getLocalPart=function(){return x.Util.nothingToBlank(this.localPart)};x.QName.prototype.setLocalPart=function(I){this.localPart=x.Util.nothingToBlank(I)};x.QName.prototype.toString=function(){return this.getName()};x.QName.prototype.clone=function(){var I=new x.Cloner();return I.clone(this)};x.Text=function(I){this.dataType=x.constants.DATATYPE_TEXT;this.isSw8tXmlContent=true;this.text=x.Util.erefEncode(x.Util.nothingToBlank(I))};x.Text.prototype.getText=function(I){if(x.Util.isEmpty(I)){I=true}var J=x.Util.nothingToBlank(this.text);return I?x.Util.erefDecode(J):J};x.Text.prototype.setText=function(I){this.text=x.Util.erefEncode(x.Util.nothingToBlank(I))};x.Text.prototype.toString=function(){return this.getText()};x.Text.prototype.clone=function(){var I=new x.Cloner();return I.clone(this)};x.Token=function(I,J){this.dataType=x.constants.DATATYPE_TOKEN;this.isSwt8XmlContent=false;this.content=typeof(I)=="undefined"?new String():I;this.isLiteral=false;this.position=J?J:0};x.Token.prototype.getContent=function(){return this.content};x.Token.prototype.setContent=function(I){this.content=I};x.Token.prototype.getPosition=function(){return this.position};x.Token.prototype.setPosition=function(I){this.position=I};x.Token.prototype.hasValue=function(){try{return x.Util.hasValue(this.content)}catch(I){return false}};x.Token.prototype.isDOCTYPEStart=function(){return this.content==x.constants.DOCTYPE_START};x.Token.prototype.isPIStart=function(){return this.content==x.constants.PI_START};x.Token.prototype.isPIEnd=function(){return this.content==x.constants.PI_END};x.Token.prototype.isSelfTerminating=function(){return this.content==x.constants.TAG_CLOSE_SELF_TERMINATING};x.Token.prototype.isEndTag=function(){return this.content==x.constants.ENDTAG_OPEN};x.Token.prototype.isCommentStart=function(){return this.content==x.constants.COMMENT_START};x.Token.prototype.isCommentEnd=function(){return this.content==x.constants.COMMENT_END};x.Token.prototype.isAttribute=function(){return this.content==x.constants.EQUALS};x.Token.prototype.isCDATAStart=function(){return this.content==x.constants.CDATA_START};x.Token.prototype.isCDATAEnd=function(){return this.content==x.constants.CDATA_END};x.Token.prototype.isTagOpen=function(){return this.content==x.constants.TAG_OPEN};x.Token.prototype.isTagClose=function(){return this.content==x.constants.TAG_CLOSE};x.Token.prototype.isQuote=function(){return this.content==x.constants.SQUOTE||this.content==x.constants.DQUOTE};x.Token.prototype.isQuoted=function(){return this.content.charAt(0)=='"'&&this.content.charAt(this.content.length-1)=='"'};x.Token.prototype.getType=function(){if(this.isDOCTYPEStart()){return x.constants.TOKENTYPE_DOCTYPE_START}if(this.isPIStart()){return x.constants.TOKENTYPE_PI_START}if(this.isPIEnd()){return x.constants.TOKENTYPE_PI_END}if(this.isSelfTerminating()){return x.constants.TOKENTYPE_SELF_TERMINATING}if(this.isEndTag()){return x.constants.TOKENTYPE_ENDTAG_OPEN}if(this.isCommentStart()){return x.constants.TOKENTYPE_COMMENT_START}if(this.isCommentEnd()){return x.constants.TOKENTYPE_COMMENT_END}if(this.isAttribute()){return x.constants.TOKENTYPE_ATTRIBUTE}if(this.isCDATAStart()){return x.constants.TOKENTYPE_CDATA_START}if(this.isCDATAEnd()){return x.constants.TOKENTYPE_CDATA_END}if(this.isTagOpen()){return x.constants.TOKENTYPE_TAG_OPEN}if(this.isTagClose()){return x.constants.TOKENTYPE_TAG_CLOSE}if(this.isQuote()){return x.constants.TOKENTYPE_QUOTE}if(this.isQuoted()){return x.constants.TOKENTYPE_QUOTED}return x.constants.TOKENTYPE_NORMAL};x.Tokenizer=function(I){this.dataType=x.constants.DATATYPE_TOKENIZER;this.isSw8tXmlContent=false;this.setMarkup(I);this.tokens=new Array()};x.Tokenizer.prototype.getMarkup=function(){return this.markup};x.Tokenizer.prototype.setMarkup=function(I){this.markup=I?I:""};x.Tokenizer.prototype.determineTokenType=function(K,J){var I=this.markup.charAt(K);var L=K>0?this.markup.charAt(K-1):null;if(x.Util.hasWhitespace(I)){return x.constants.TOKENTYPE_WHITESPACE}if(this.markup.slice(K,K+9)==x.constants.DOCTYPE_START){return x.constants.TOKENTYPE_DOCTYPE_START}if(this.markup.slice(K,K+9)==x.constants.CDATA_START){return x.constants.TOKENTYPE_CDATA_START}if(this.markup.slice(K,K+4)==x.constants.COMMENT_START){return x.constants.TOKENTYPE_COMMENT_START}if(this.markup.slice(K,K+3)==x.constants.CDATA_END){return x.constants.TOKENTYPE_CDATA_END}if(this.markup.slice(K,K+2)==x.constants.PI_START){return x.constants.TOKENTYPE_PI_START}if(this.markup.slice(K,K+2)==x.constants.PI_END){return x.constants.TOKENTYPE_PI_END}if(this.markup.slice(K,K+2)==x.constants.TAG_CLOSE_SELF_TERMINATING){return x.constants.TOKENTYPE_SELF_TERMINATING}if(this.markup.slice(K,K+2)==x.constants.ENDTAG_OPEN){return x.constants.TOKENTYPE_ENDTAG_OPEN}if(I==x.constants.EQUALS&&J){return x.constants.TOKENTYPE_ATTRIBUTE}if(I==x.constants.TAG_OPEN){return x.constants.TOKENTYPE_TAG_OPEN}if(I==x.constants.TAG_CLOSE){return x.constants.TOKENTYPE_TAG_CLOSE}if(I==x.constants.SQUOTE){return x.constants.TOKENTYPE_QUOTE}if(I==x.constants.DQUOTE){if(L!==null||L!="\\"){return x.constants.TOKENTYPE_QUOTE}}if(I==x.constants.BRACKET_OPEN){return x.constants.TOKENTYPE_BRACKET_OPEN}return x.constants.TOKENTYPE_NORMAL};x.Tokenizer.prototype.isQuote=function(I){return I==x.constants.SQUOTE||I==x.constants.DQUOTE};x.Tokenizer.prototype.toString=function(){var I=this.tokens;var K=new String();for(var J=0;J<I.length;J++){if(J>0){K+=","}K+=I[J].content}return K};x.Tokenizer.prototype.tokenizeTagContent=function(M,K){var J=false;var N,I;for(var L=K+1;L<this.markup.length;L++){if(this.markup.slice(L,L+9)==x.constants.CDATA_START){J=true;break}else{if(this.markup.charAt(L)==x.constants.TAG_OPEN){break}}}if(J){I=new x.Token(x.constants.CDATA_START,L);M.push(I);I=new x.Token("",L+9);I.isLiteral=true;N=x.constants.CDATA_END;for(K=L+9;K<this.markup.length;K++){if(this.markup.slice(K,K+3)==N){M.push(I);I=new x.Token(N,K);M.push(I);K+=2;I=new x.Token("",K+3);break}else{I.content+=this.markup.charAt(K)}}}else{I=new x.Token("",K+1);I.isLiteral=true}return{token:I,c:K}};x.Tokenizer.prototype.tokenize=function(){var K=new Array();this.tokens=K;var R=new x.Token();var S=false,U=false,Q=false;var J,T,V,L;for(var M=0;M<this.markup.length;M++){var I=this.determineTokenType(M,S);switch(I){case x.constants.TOKENTYPE_DOCTYPE_START:U=true;if(R.hasValue()){K.push(R)}R=new x.Token(x.constants.DOCTYPE_START,M);M+=8;break;case x.constants.TOKENTYPE_BRACKET_OPEN:if(U){if(R.hasValue()){K.push(R)}R=new x.Token(this.markup.charAt(M),M);R.isLiteral=true;J=x.constants.BRACKET_CLOSE;for(++M;M<this.markup.length;M++){R.content+=this.markup.charAt(M);if(this.markup.charAt(M)==J){if(R.hasValue()){K.push(R)}R=new x.Token("",M+1);break}}}else{R.content+=this.markup.charAt(M)}break;case x.constants.TOKENTYPE_PI_START:var N;var P="";if(R.hasValue()){K.push(R)}R=new x.Token(x.constants.PI_START,M);K.push(R);T=M+2;S=true;for(M=T;M<this.markup.length;M++){N=this.determineTokenType(M,S);if(N==x.constants.TOKENTYPE_PI_END){P=this.markup.slice(T,M);if(x.Util.isUndefinedNullOrBlank(P)){P="xml"}R=new x.Token(P,M);K.push(R);R=new x.Token(x.constants.PI_END,M);K.push(R);S=false;break}else{if(N==x.constants.TOKENTYPE_WHITESPACE){if(P===""){P=this.markup.slice(T,M);if(x.Util.isUndefinedNullOrBlank(P)){P="xml"}R=new x.Token(P,M);K.push(R)}break}}}R=new x.Token("",M);break;case x.constants.TOKENTYPE_PI_END:R=new x.Token(x.constants.PI_END,M);K.push(R);S=false;M+=2;R=new x.Token("",M);break;case x.constants.TOKENTYPE_WHITESPACE:if(R.isLiteral){R.content+=this.markup.charAt(M);break}for(++M;M<this.markup.length;M++){if(x.Util.hasWhitespace(this.markup.charAt(M))){continue}else{if(R.hasValue()){K.push(R)}I=this.determineTokenType(M,S);if(I==x.constants.TOKENTYPE_NORMAL){V=this.markup.charAt(M);R=new x.Token(V,M)}else{M--;R=new x.Token("",M+1)}break}}break;case x.constants.TOKENTYPE_SELF_TERMINATING:case x.constants.TOKENTYPE_ENDTAG_OPEN:S=false;if(R.hasValue()){K.push(R)}R=new x.Token(this.markup.slice(M,M+2),M);if(R.hasValue()){K.push(R)}M++;R=new x.Token("",M+1);break;case x.constants.TOKENTYPE_TAG_CLOSE:S=false;U=false;if(R.hasValue()){K.push(R)}R=new x.Token(x.constants.TAG_CLOSE,M);K.push(R);var O=this.tokenizeTagContent(K,M);R=O.token;M=O.c;break;case x.constants.TOKENTYPE_ATTRIBUTE:case x.constants.TOKENTYPE_TAG_OPEN:if(this.markup.charAt(M)==x.constants.TAG_OPEN){S=true}if(R.hasValue()){K.push(R)}R=new x.Token(this.markup.charAt(M),M);if(R.hasValue()){K.push(R)}R=new x.Token("",M+1);break;case x.constants.TOKENTYPE_QUOTE:if(R.hasValue()){K.push(R)}R=new x.Token(this.markup.charAt(M),M);R.isLiteral=true;J=this.markup.charAt(M);for(++M;M<this.markup.length;M++){R.content+=this.markup.charAt(M);if(this.markup.charAt(M)==J){if(R.hasValue()){K.push(R)}R=new x.Token("",M+1);break}}break;case x.constants.TOKENTYPE_COMMENT_START:if(R.hasValue()){K.push(R)}R=new x.Token(x.constants.COMMENT_START,M);K.push(R);J=x.constants.COMMENT_END;T=M+4;for(M=T;M<this.markup.length;M++){if(this.markup.slice(M,M+3)==J){L=this.markup.slice(T,M);R=new x.Token(L,T);R.isLiteral=true;K.push(R);R=new x.Token(J,M);K.push(R);M=M+2;break}}R=new x.Token("",M);break;default:R.content+=this.markup.charAt(M);break}}if(R.hasValue()){K.push(R)}return K};x.Util=new Object();x.Util.hasWhitespace=function(L){if(typeof L=="undefined"||L===null){return false}var M=L+"";var J=new RegExp(/^\s+$/);for(var K=0;K<M.length;K++){var I=M.charAt(K);if(J.test(I)){return true}}return false};x.Util.isUndefinedNullOrBlank=function(I){return !x.Util.hasValue(I)};x.Util.isEmpty=x.Util.isUndefinedNullOrBlank;x.Util.nothingToBlank=function(I){return x.Util.isEmpty(I)?"":I};x.Util.isAllWhitespace=function(L){if(typeof(L)=="undefined"||L===null){return false}var I=L+"";for(var K=0;K<I.length;K++){var J=I.charAt(K);if(!x.Util.hasWhitespace(J)){return false}}return true};x.Util.hasValue=function(I){if(typeof I=="undefined"||I===null){return false}var J=I+"";return !(J.length===0||x.Util.isAllWhitespace(J))};x.Util.trim=function(I){var J=I+"";return J.replace(/^\s+|\s+$/g,"")};x.Util.leftTrim=function(I){var J=I+"";return J.replace(/^\s+/,"")};x.Util.rightTrim=function(I){var J=I+"";return J.replace(/\s+$/,"")};x.Util.splitByWhitespace=function(I){if(typeof I=="undefined"||I===null){return I}var J=x.Util.trim(I)+"";return J.split(/\s+/)};x.Util.removeArrayItem=function(K,J){try{for(var I=0;I<K.length;I++){if(I==J){K.splice(I,1)}}}catch(L){}return K};x.Util.dataType=function(I){return typeof I!="undefined"&&I!==null&&I.dataType&&typeof I.dataType=="string"&&I.dataType.length>9&&I.dataType.slice(0,9)=="marknote."?I.dataType:typeof I};x.Util.replaceAll=function(K,I,L){var J=K+"";var M=0;var N="";while(J.indexOf(I,M)!=-1){N+=J.substring(M,J.indexOf(I,M));N+=L;M=(J.indexOf(I,M)+I.length)}N+=K.substring(M,K.length);return N};x.Util.erefEncode=function(I){var J=I+"";return x.Util.erefTransform(J,true)};x.Util.erefXMLEncode=function(I){var J=I+"";return x.Util.erefTransform(J,true,true)};x.Util.erefDecode=function(I){var J=I+"";return x.Util.erefTransform(J,false)};x.Util.erefXMLDecode=function(I){var J=I+"";return x.Util.erefTransform(J,false,true)};x.Util.erefTransform=function(M,J,I){var L=I?new x.XMLEntityRefs().getRefs():new x.EntityRefs().getRefs();var P=new String();P+=M;for(var O=0;O<L.length;O++){var Q="&"+L[O].name+";";var R=L[O].character;var K=J?R:Q;var N=J?Q:R;P=x.Util.replaceAll(P,K,N)}return x.Util.replaceAll(P,"&quot;",'"')};x.Writer=function(){this.dataType=x.constants.DATATYPE_WRITER;this.isSw8tXmlContent=false};x.Writer.prototype.outputDocument=function(I,Q){var R=new String();var P=I.getProcessingInstructions();var M=I.getDOCTYPE();for(var S=0;S<P.length;S++){if(S>0){R+="\n"}R+=x.constants.PI_START;var O=P[S];R+=O.getTarget();var L=O.getData();for(var J=0;J<L.length;J++){var N=L[J];R+=" "+N.getName()+'="'+N.getValue()+'"'}R+=" "+x.constants.PI_END}if(M){R+="\n"+M.toString()}var K=I.getRootElement();R+=this.outputElement(K,0,Q);return R};x.Writer.prototype.outputElement=function(M,Q,N){var O,K,J;O="\n"+this.calculateIndent(Q,N)+x.constants.TAG_OPEN+M.getName();for(var I=0;I<M.getAttributes().length;I++){var L=M.getAttributeAt(I);O+=" "+L.getName()+x.constants.EQUALS+x.constants.DQUOTE+L.getValue(false)+x.constants.DQUOTE}if(M.isSelfTerminated||!M.hasContents()){O+=" "+x.constants.TAG_CLOSE_SELF_TERMINATING;return O}O+=x.constants.TAG_CLOSE;if(Q===0){Q=1}K=this.outputContents(M,Q,N);J=M.contents.length==1&&M.getText().length>0&&this.hasStrictText(M)?"":this.calculateIndent(Q,N);var P=J+x.constants.ENDTAG_OPEN+M.getName()+x.constants.TAG_CLOSE;return O+K+P};x.Writer.prototype.hasStrictText=function(K){var M=true;for(var I=0;I<K.contents.length;I++){var L=K.getContentAt(I);var J=x.Util.dataType(L);if(J!=x.constants.DATATYPE_TEXT){return false}}return M};x.Writer.prototype.calculateIndent=function(K,J){if(K===0){return""}var L="";J=J&&x.Util.isAllWhitespace(J)?J:"\t";for(var I=1;I<K;I++){L+=J}return L};x.Writer.prototype.outputContents=function(P,S,Q){var T=this.calculateIndent(S+1,Q);var I=this.calculateIndent(S+2,Q);var R=new String();var L="";var J,K,O;for(var M=0;M<P.getContents().length;M++){var N=P.getContentAt(M);L=x.Util.dataType(N);switch(L){case x.constants.DATATYPE_COMMENT:R+="\n"+T+x.constants.COMMENT_START;K=N.getText();O=K.split("\n");for(J=0;J<O.length;J++){R+="\n"+I+x.Util.leftTrim(O[J])}R+="\n"+T+x.constants.COMMENT_END;break;case x.constants.DATATYPE_ELEMENT:R+=this.outputElement(N,S+1,Q);break;case x.constants.DATATYPE_TEXT:R+=N.getText(false);break;case x.constants.DATATYPE_CDATA:R+="\n"+T+x.constants.CDATA_START+"\n"+I+N.getText()+"\n"+T+x.constants.CDATA_END;break}}if(L!=x.constants.DATATYPE_TEXT){R+="\n"}return R};w=(new x.Parser()).parse(A.data.data);t=w.getRootElement().getChildElements("trk");for(E=t.length;z<E;z++){H=t[z];D=H.getChildElements("trkseg");for(F=D.length;s<F;s++){v=D[s].getChildElements("trkpt");y=v.length;for(;u<y;u++){B=v[u].getAttribute("lat").getValue();C=v[u].getAttribute("lon").getValue();G.push({latitude:B,longitude:C})}}}self.postMessage(G);self.close()};try{q=new Blob(["self.addEventListener('message', ",m.valueOf(),", false);"])}catch(o){q=new h();q.append("self.addEventListener('message', ");q.append(m.valueOf());q.append(", false);");q=q.getBlob()}j.onload=function(r){p=new Worker(i.createObjectURL(q));p.postMessage({data:r.target.result});p.addEventListener("message",function(t){var s=t.data;if(s&&s.length&&s.length>0){mapController.renderActivityPoints(s);$("input[name=mapEdited]").val(true);f("Map successfully edited.")}else{f("No point found in your gpx file. Map not edited.")}},false)};c.innerHTML="Reading the file...";j.readAsText(n[0])}function g(j){j.stopPropagation();j.preventDefault();j.dataTransfer.dropEffect="copy"}})();}

          document.getElementById("bk").href = "javascript:(" + bk.valueOf() + "());";
        </script>

<h3>Testimonials</h3>

<ul>
  <li>Amazing! Works like a sharm! &mdash; <a href="http://support.runkeeper.com/discussions/questions/2878-create-new-race-map-from-activityroute#comment_17209020">Bjornar</a>&nbsp;<ins datetime="2012-08-03">(link broken since last Runkeeper support platform migration)</ins></li>
   <li><ins datetime="2012-08-03">this is phenomenal! I was trying to create a 5.7 mile trail race and it was impossible to get it all correct. Your bookmarklet worked like a champ! Thanks! &mdash; <a href="http://support.runkeeper.com/entries/21704641-editing-a-race-s-map-using-a-gpx-file?page=1#post_21712432">Hollis</a></ins></li>
   <li><ins datetime="2012-09-18">Love the rkrace-bookmarklet! Great for creating race map (!) &mdash; <a href="https://twitter.com/HeatherUrry/status/244604352529043456">@HeatherUrry</a></ins></li>
   <li><ins datetime="2012-09-22">Thanks Valentin. This is super helpful for everyone. Throwing this up on the support home page for everyone to see! &mdash; <a href="http://support.runkeeper.com/entries/21704641-editing-a-race-s-map-using-a-gpx-file?page=1#post_21970628">Chas Wagner (from RunKeeper crew)</a>
</ul>

<h3>Support or Contact</h3>

<p>Having trouble? Ping me directly on twitter (<a href="https://twitter.com/jacqueminv">@jacqueminv</a>) or fill an <a href="https://github.com/jacqueminv/rkrace-bookmarklet/issues">issue on github</a>.</p>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
  </body>
</html>
