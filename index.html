<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rkrace-bookmarklet by jacqueminv</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style>
      #bk {
        display: block;
        height: 3em;
        text-align: center;
        padding: 1.5em 0 0;
        margin: 0 0 1em;
        background-color: #eee;
        border-radius: 1em;
      }
      
      ins {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>RKrace-bookmarklet</h1>
        <p>Edit a race map on Runkeeper simply by droping a gpx file.</p>

        <p class="view"><a href="https://github.com/jacqueminv/rkrace-bookmarklet">View the Project on GitHub <small>jacqueminv/rkrace-bookmarklet</small></a></p>

      </header>
      <section>
        <h3>Editing a race map, one click away</h3>
        
        <p>Being a fan of Runkeeper since a while I was annoyed by their race map creation workflow. You have to provide the race map and this is possible only by manually setting points. This can take minutes if not hours for some races and it can be hard to be precise (e.g. trail races anybody?).</p>
        
        <p>The little hacker deep inside me kept urging me to have a try fixing this. Here comes my bookmarklet.</p>

        <p>Drag and drop the following link in your bookmarks. Next time you want to edit a race on Runkeeper, simply click this bookmark and a small box asking you to provide a <code>gpx</code> file will appear. Drag and drop the race file and the process will start. This can take a while depending on your browser and available resources as everything is done in the browser. Nothing is sent or tracked from this bookmarklet. The code is open feel free to check.</p>
        
        <a id="bk" href="">
          rkrace-bookmarklet
        </a>

        <script>
          function bk(){javascript:(function(){var c=document.createElement("div");c.innerText="Drop the gpx race file here.";c.setAttribute("style","font: bold 0.8em Arial; width:13em; padding: 14.5em 0 1em 0; background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIEAAACWCAIAAAB2EXwkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAFLlJREFUeNrsXQlsHNd5nmtP7kFyeUkiJVq2pZaWLEt1bEFWY6dGmjRpIdSAY8tV3SNJ6/QI4B4obLhxYcMOUDRxggZw0ThIYihJ3SKKauc04qOVlNSBK6uyTlsWFZGSeJjL5bH3zky/2X/59DSzF/dech6Wg+HMm+v/3v/9x5t5TwyHw4JdmlokWwQ2BnaxMbAxsIuNgY2BXWwMbAzsYmNgY2AXVpTlHqDrOpZatujZ0iJPwt8Jvy5JRjsTRVHKFqzQdrbSZhjg2SD6TLakUiksCYlGyrfkLn6LmC09PT24W6wo2dI60q9QD1RVxfNgJRAIAIPm6gFaQDn6Crl3dnaOj4+n02mXy+VwOKAQqNAiYCxbD4BBLBbDY6BxNZ5kSmoGjwrWk9kCDJxO5+Dg4NjYGG7e6/Xi/klF2s8m48nRlKLRKJ6kiQAUIkkCgKwUcSZUdnFxcX5+Htsh9w0bNmC5sLAAYNCYGkOktceAuAjP0CLmN+8uwgDNBW0FGMzNzTGzPDAw4Ha7sQV78SytgMGy7QG1r/JbaAPEbfqXCkSMhhKPxwED3TD5SOAlwDAzMxMOh4PBIDiK+U5tg0FxS9hgIuIB4Ndxh2jjBAO0FuSJLSRoLGVZ7u7uxnJ2dhbbYaUBTBNhaNcYzSR00zoBQN4zrSQSCXasnC1+vz8UCgEe6ArqNKxhtRMGxZXAREEmy0wRDFldgoHHgGBA24eD1NfXh10MhqaYB6lNlcBqEpglYKKn8IXWTY4c7DPB4PF4AAMoC6Yb6tIUGJQ6tdN6C93U/EnWFEJSwyefhyJ5FKszTfYZdWCWAcPU1BR8Vp/Ph3/5lIatB+UaBqtBNmW0wPt5Hj4LAwqCBsAAuQMGaEODfVapfcVtdU81S2G7wPj5n38JBpSuri4sETpQBNcwGKS2EH3JvXx2iImeHYgGbrLJvGEgb5W0Ac4SlpFIBJg1LBumtIXQrWaArTPlYB4RYcCIiEqR5AqpAuMxwIAt0AaoAiw2JfhWFwaFml7evgqrY2qFihp78QQXqQJDDj4rlvPz87Re7wSf0qZcZFIIvpgqkJMDii+erCYMyFNCgQZgCRMNVOAsUSBdJxjaAINyQmXGP3lxgnwhQZgESLbICQkGxmxUGXEDwQBtQIV6wNBa8UERS8D/y3MOLzWrGWB6gCXMbHEMKHDjzQxdCNoA2xAIBBA61AOGNtaDQg5rXsmSHpR2E5cCNyyZl9XR0QFtgLXv7OykBF9tYVDaUehWjSkEA+vHx7LMPg8GA68QsMxQo5mZGcBAzlINYVBWsBKwNyooUVqOHlhh4GMOOFfhcBihHIOhJkhUiEGdclvW1l0oN5fXKlhRYa+0AIPy+/5Y4GayNG63GzCQNtTQWVLaVwOKC5EKI6LyuShv4MYvQUrT09MUzVEEVyUMSltLP68zShJhGDA9KJ+L8gZuPDVBG6ampuAsBYPB6n3WFvJNy+k6zks4JZ0iFNYNvqxiCtx42wBtAAxYBwxwlqqBQWlrzinCQiYigowqwMAauJmWk5OTWOnu7oapWLEYVAAAT0QUGYAuWCcz1pd7TpwErT4SiVDvEPXQQfSObJmdnaWcUsWpPaX1xcr8n+WyOYMBZ8ASYjpz5gy2UA8PZMre9FKzhfjq8uXLbAvTAD7FjYJWDwrq7+8fGhqCKoRCIcRxKyRXUdIxNWUR8mbrTC4m4yJUAINTXz91dlLHJwOAlpSt4y9hOhWwBAaBQAB+EVbo9Rkcu3pzFbzE+VwpvVBEBpnPmDJrQRLncxJ54x5WnyHhdDohfdiAnp4erFTfHJUVJn1TcEDN1kTukDtr+Czc47WNBdhWMwsAwP4IlRGmkRlg9rnRGDTAMS30BpG1Ny3vzZD4mHPJckdW38Z6dQYqrTCTgPOA9yF9YiHmj666GK2IsKjtk0wp0AXvk6SoAjV8/n0LU+RB0uRzISwMJDMAAAADAWDn7PI3fEb99JUHBAerS9gAANpogsGaeaV1qkz+FSQO5kHzxxIRWavkrmtLR8X7igXLy3RCvnw1204eLTEP+aa0wg5nYDBjQApk+oKBoAWQcJZ8Ph+W9J62yQLZemCmJtZ+eXYiVExAMqLPa3XoKHofEs0f/FOndyxWFAZWO0EUxDwlgoG3tCwzyuOXE81SOAYDgObPvx9f22/Z2oCLCnlBheIyZkVpnbcTxE4mIZqiB3ZaAoC6a5gFLtTDsYr0wBoK5IWBWjQBwMRK/1JLZ0lpU1aO8CAjDNtL/MM8qzo9lNK+crdu55NFJGgWADPp8wcyJHioyAaAfCgjXdIAVK8KrctFeR0eq4NU5LV43uU3nY3FVuQ+8RpA2VB6jYU3ACakbb9I4OMyU+vmV/LKnceJURZVoPQqAGDdDw14EKV9hZ7XHlgjZ94xtdpeFhkQNQEAen2okZ8ItvR3OHkpqHjuqMgZ8hoYPiEK6fPm14plEX6z80WClXlY4tOkNPwu3oYT+/PNv2GDKSitowTFQ4QyX6zL+6FOXt+JB8MKgDUQq5/erxybXNwsF4ok+Jch8yYBGQCswkp+57e4gRUsAxMxAKw9aEWas2nd5P/w5iEvHlYAmvmeXePpKK81tjJPoaSm1a7y/ZQ8YCY7XG8HRGlTFuJFZjLLhXJBfLW8ABSxw4X6y5r5zm/jCSovU1lhsHqTVoeS76MvJOhC9LXy44Nyhuwq2Zlspa8yhWg1MNZAweai/BRRRD9KspmVhRo/8GNLf39QTuRcvIWa4rLyVcE66GChJPlK04OST2U1tsWtRTnhrskMsFCg0FE11w+pNemlgvqVpRas/NP4wR7bY+wcodSLF0W+7i8H3eJ+VL0fvG1scpEoupBxLqlV1vC4wda4RbmoTJoq4uCXcx6ec5o+0mzr6kE59FLO51BFzmDyYsuJA1prrISWig8KcVGZprgezsLKscnlaEPFrm2R/p+SkaCtB6WTo+V7tM1q/m1jk4vnG6oUUEmvqdXfq2hYfFDOhZZrCUoeVb8MXVtyUTniKP7qVYvY3va2B+W3yrqyU2th0JTZiOp9xUbyT7v6RfXzEZsbKrdNzq6tNay9fdPVUGwMbAzsUj+bbB3NYyXZD77QgDo04ws/ck/e95cahAGbjGMuoyyKHRnRqYryCm7FG+66H41rwnjy7E8QZF116GmfEAsqmXK+ZatxfMCmgHgn6hlXgxcXhPPzwlxST2urhVgckhB0SRsDrvV+15Ayv6kjXnL4R6XmSgAALiwIr4cDEzHtcnTVkXtSE6YywlRUuDgvDHj9bi2x3p8pPiZtLeMDmn8mmUz+53goJuqXF1aoBSivXF4QHKJwcNz7mRsipAeFYFBqqwQgIpimd8Ka062qmrDKy3RMGE/oEAgNc9QgDMhJWEykXJJL01c7BotJIRlP0jCENIZS3bmIBoYzJntTtbS66hEQBBABRFFypu8a2+TcyHDgoSrG2LMQHCBNampa0DVRkiXFKTpcoihZq+lqOn//AegYR4nsg29Nz6RRf2mvLCqOa05onCwN+eXetLBWKF8gSwMWNggDFovhmmL1009CEJlUJhpxpSO3Dihr/bhVUKr85njs3IzT4euS3T5Rzt2/rmbc6chGT1RL5RlQWRQdRy+rDl83DgGEkO9G96Ins6ClExBwVHOMLgSVjmBOyrj/ZKxHC/e7Uzit5HDHFf/5hHFgBQ+hFhiurY7xQW6cOFy5OotsnCMRdS5e+ezOznt3fcC0d2x67huHzv/w4rwz2EeigScw7Fr8yt6bC51wLpr47v+c//bJSMrbL8pyJhH7yoNb2d59//qLi3GH7PIap8oklfnLz+y7cagnQHv/4PlTmuoVRK0iPSg9OGvt80WkB1k2qvSXUVOLc0PqpQN/evO9uzZZLzHUG/z7e7Y//AFnInwlk06pWc5VU/EidxXscP/x3SNf3jMI+app9WxEfualY2zvn+1ek5idME4F33ouvPcmFwMA1VBZF6QKn6WMjwTqki/Sq7MHWirenbzy7J/sgODYxhOjE3Ox5FBvYH1fF235xB2bxsPHXnhvxuEL4XK6fPVRL06Ex2YWDG7R9YDXueW6Adp+04beh26b/cKbc0pH5/63Ix/eOrVluA/bd40MfezE5I+vRESHc1iZ+dSHd+cuemFq/9tJd2+/Zjh5amWiaE7OzggNKuYiXUtGph/dM8QAOHLy4pPfPzeZ6RAlRUuNfWi98A/3/lrQZ8wu9Fe/c8tPv3hkJuXD5XTOF37h8Nn9J1KKJ5CdUTyxPXT6mQd30iGf2L3p6VcOS55O2d/7xItn//2zfXTIwx/f8tMvvbGYFh/7w83sPKgg+9dpulTx45QTJUl1wkCttKQT0e2hFBomnert0Ym//d75993rHV2DSucaR8+G16d8X3jpOLvW3Tf6Qe7GBfWrTysqLtnXIwf6leCAI7T+6GzHD998j+29dZ0jnUwIsvPdeOCfDv4vI6t92zwPjMhbhvtpC3ahAqqpVRWtOXoAgYiVclEmvnjb5qszaD336rm4q1eWnOzLb8kTPPjuxEdPX4YnKsBrlI1dYtYfuNZT5fhQco7NXE1dwXpoGRyrSJ7AN98a+8i2ya3XGXJ/6Ldvm1uILWE/+c23os7QUMUsxERRRwyKDJJigJ+pUHnT8diuTRvZvy+/G3f1rUUjB0fBVzWcerR3xfvp74zCgYHnLrt8sidgiJXjItRVM5qIe9CzHu5i5KZ1a9jeSNxATTfuUJK8PY9/9+SBv8m1/aDfSyvYKHkHNE0SqnOym6YHxiDoFetBMr51Y86EHjo+qsvZnAdAyKTWOBbXdCSN5o9ijPUtIfha0NR3FpPCtfOyqMloYnpWmp8GBn6Hev+24Md35lj+l5Ozp6ZVZ7eYu0PZeXre/fkXjjxy3x3scPyLjY6AU6060lSbZZO1KjBQ1QwfXAEAegwtGbt7k/x3v3uHqf7hk+Of/LeLksvH68EjD9z5yAP5z/+dw+8JTp/KGEbPjjyuide6BYYqwxsVRL0GohDEhnJRrhMto+mVcpGm8rJASJuRsqeCU6+pUr76iAxSugymKn3Fb7168qtvLCiBfnXp9rRUbFNH/NG9v8lXe3Tv7p89/fI78Zjk9FaLgXEhuTlcpFeqB5oo/d+5y9tuWIv1D27bmHnuhJROwfbqonxiKv30f7xpWIV0fN9vbB1e28OikexfsTb70s/P/ODY5E/eU2UEE1lyIx3IRCae+stbrPWfum/rnn8+pnQNwuRUrQdNwUDTKsZAl5zHL7xPGKB8ZLP35UuLoBpBlH92ST1yEfYgkw6P/cWe25eUD5dTjZwApwdPPv/KvxyekpxL86NIsuRwi64OqcOjwR1Xl1goNvvp24Pbrs+Z6+d/9IsNA113br8R69j4qdtHv3p0RvZ2CWLlHrymNTM+qPAHI/zSWxPsVH/+0ZHU7BUYaiMIk5y64kWdB3YOdfq9VxmLDuT7KxSPFFgndW3I/YKDgrdHlz1G7Lh0IUQVm33Rx/buyjlLi/GnfjD61PdOsXNgFyoYwYdaVeqlXhjoRYuWUSv+6YJyaDT1X8fO04WgEM/u+5WB9KXU+2Pp8KXU1OjO0MJj99/O3YrBucaxfIsreQ+pVHpu8h9/bzs74q+/dmhR6TsR8T6x/xDbiAqohsrVPFHT/CK9Gq/OFXjywCmwQaffCNb27B7B7/Wj5+AmDQ90Dq8JWVKExuV4PchNN1HoHmC+Y5HP7A7dssR4Bw+f+v7phOwPQqf2vzH14N3h4TXd2I4KD+0OPfvzsOTtrIyRypFDy3GR0eEhOo7PuO/5/E8iC1dToXftuOGu7dczAJ759iumy2lcrkIrmrsFs410Jh7f9+s5FlqIPXngjO7qBG3AWkR0/8PPHWGnQrWRYCzLSGpbcVG1IOi64j4+6/3Q53709R8ftV798ecPPfHi6LFzV7JP4NAF2dAB+WqSVZRdui4WPH86+bn7drDKXzr41oWoG34X5ZphkP77gnrwyFlW4YufvMOvVP44JYUphsPhZQSxmczc3NylS5fS6fTIyIg5zZBOx2KxSCTysW/Mi86OqtVJR2ysp6JBKXbX5s4NvYYRnotlDh6dmkeULDv1VEzIJASHR3L5Dec1HdcTC7qaFGUHri46fUIht1JNa8kFIRWDtuSvTBXSMSM1Ikqi4VMFRKOzaNmfKeD+X32ojyaRojlEGmYPNLEmb7aIDsEVnNP8B8+mhNMLhv2VFFHuxdIQh9uVuxz9yR6hwyPm7LThsxZOOMuCqxO/wpWvqZCroy69y7g8e9CsfFFN+pM5KATZZfw4vq9AHE0p5UTvtc9VZAP0tChlhGaPxdECCBh5m5KvXtdYD+h6bjETTycFxbXaMcgkXUJKKPW9m1JzALAc8sZOv58Qfb0VGLEVpQWx8PX9YsnxSWqvB7Is//6tHY8e+KUGT8PdtXohSMyKsek/2rmJBjRvEAZsFoEd13Xdf/Pkt44cF/zrRN+A4HALK/ozEJMnJKQT+uKEsHDpwTuHd2zsbuj3BzSbD80rufeD113f63jxyJnzY8fmYqlVpQDBDtcNazvv+a0tO29aTzNL0dwiDcKApjNBPIK4/rZfHdw6HEqlUnUaDLVFyunTp/v7+7u6uiBuJgSEYx6Px+/30/x2jeYiXJLNfEXTbLMJslZkgZQDgUAwGITQhaUZgl3Zgl1sirsGfYeTy0BlYaDmAAz4N79XpDYAAChBKBSC9gvcNNkQPWCgCR8b55syVWDGmV775iemX3nF5/OBc6AHwIBNG0xzyNNKvb7LLA4Dm18DMFQ29GIbFTR2mliWYdD875N5JFaDF0S0QzPbVXYGe6yEFkCxYoOs6/YXZ7Upy9YDsvtsPmG7lAyDa68HFIDYomeFIoDGYUBKgKvOz8+/9tprMzMz0WgUEcAqFD0aIiKD3t7ewcFBioQbhAGuBMwR/vX09GAFS4TBaq0+g203CkJbRHCAAA0r1ZBzJVyESwIMxMCpVIqisNVoSLPNkfJCWGmcHhAXsTwEJSFWp4PE4tCS3QO11wPbL2q+b2oXGwMbA7vYGNgY2MXGwMbALjYGNgZ2sTGwMbCLjYGNgV3qWv5fgAEAZ3EV/EUnHxMAAAAASUVORK5CYII=') #EAEAEA no-repeat; position: fixed; top: 1em; left: 1em; z-index: 99999; text-align: center;");c.addEventListener("dragover",h,false);c.addEventListener("drop",a,false);document.body.appendChild(c);var b=document.createElement("div"),d=("draggable" in b)||("ondragstart" in b&&"ondrop" in b),g=!!(window.webkitURL.createObjectURL||window.URL.createObjectURL),j=!!(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder),i=!!window.Worker,f=!!window.FileReader,e=function(k){c.innerText=k||"";setTimeout(function(){c.parentElement.removeChild(c)},2000)};if(!(d&&g&&j&&i&&f)){e("You need a more recent browser");return}if(!window.mapController){e("Either you're not on RK race edition page, or RK made modifications to the code.");return}if(!mapController.model.editable){e("You must edit the race before proceeding.");return}function a(l){l.stopPropagation();l.preventDefault();var p=l.dataTransfer.files,r,q,k,m,o=window.webkitURL.createObjectURL||window.URL.createObjectURL;if(p.length!==1||p[0].size&&p[0].size>5242880){alert("Please give only one file (max size accepted: 5mb)");return}k=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;r=new k();function n(u){marknote=function(){};marknote.constants={DOCTYPE_START:"<!DOCTYPE",CDATA_START:"<![CDATA[",CDATA_END:"]]>",COMMENT_START:"<!--",COMMENT_END:"-->",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSE_SELF_TERMINATING:"/>",ENDTAG_OPEN:"</",EQUALS:"=",SQUOTE:"'",DQUOTE:'"',PI_START:"<?",PI_END:"?>",BRACKET_OPEN:"[",BRACKET_CLOSE:"]",TOKENTYPE_BRACKET_OPEN:"bracketOpen",TOKENTYPE_TAG_OPEN:"tagOpen",TOKENTYPE_TAG_CLOSE:"tagClose",TOKENTYPE_ENDTAG_OPEN:"endTagOpen",TOKENTYPE_ENDTAG_CLOSE:"endTagClose",TOKENTYPE_SELF_TERMINATING:"closeTagSelfTerminating",TOKENTYPE_WHITESPACE:"whitespace",TOKENTYPE_ATTRIBUTE:"attribute",TOKENTYPE_QUOTE:"quote",TOKENTYPE_QUOTED:"quotedLiteral",TOKENTYPE_NORMAL:"normal",TOKENTYPE_COMMENT_START:"commentStart",TOKENTYPE_COMMENT_END:"commentEnd",TOKENTYPE_CDATA_START:"cdataStart",TOKENTYPE_CDATA_END:"cdataEnd",TOKENTYPE_PI_START:"piStart",TOKENTYPE_PI_END:"piEnd",TOKENTYPE_DOCTYPE_START:"docTypeStart",DATATYPE_ATTRIBUTE:"marknote.Attribute",DATATYPE_CDATA:"marknote.CDATA",DATATYPE_CLONER:"marknote.Cloner",DATATYPE_COMMENT:"marknote.Comment",DATATYPE_DOCTYPE:"marknote.DOCTYPE",DATATYPE_DOCUMENT:"marknote.Document",DATATYPE_ELEMENT:"marknote.Element",DATATYPE_ENTITYREF:"marknote.EntityRef",DATATYPE_XMLENTITYREFS:"marknote.XMLEntityRefs",DATATYPE_ENTITYREFS:"marknote.EntityRefs",DATATYPE_PARSER:"marknote.Parser",DATATYPE_PROCESSINGINSTRUCTION:"marknote.ProcessingInstruction",DATATYPE_QNAME:"marknote.QName",DATATYPE_TEXT:"marknote.Text",DATATYPE_TOKEN:"marknote.Token",DATATYPE_TOKENIZER:"marknote.Tokenizer",DATATYPE_WRITER:"marknote.Writer"};marknote.SJAX=function(){this.req=null;this.status=null;this.statusText=null;this.responseText=null};marknote.Attribute=function(w,v){this.dataType=marknote.constants.DATATYPE_ATTRIBUTE;this.isSw8tXmlContent=false;this.name=w;this.value=marknote.Util.erefEncode(marknote.Util.nothingToBlank(v))};marknote.Attribute.prototype.getName=function(){return this.name};marknote.Attribute.prototype.setName=function(v){this.name=v};marknote.Attribute.prototype.getValue=function(){return marknote.Util.erefDecode(marknote.Util.nothingToBlank(this.value))};marknote.Attribute.prototype.setValue=function(v){this.value=marknote.Util.erefEncode(marknote.Util.nothingToBlank(v))};marknote.Attribute.prototype.clone=function(){return new marknote.Attribute(this.getName(),this.getValue())};marknote.CDATA=function(v){this.dataType=marknote.constants.DATATYPE_CDATA;this.isSw8tXmlContent=true;this.text=marknote.Util.nothingToBlank(v)};marknote.CDATA.prototype.getText=function(){return marknote.Util.nothingToBlank(this.text)};marknote.CDATA.prototype.setText=function(v){this.text=marknote.Util.nothingToBlank(v)};marknote.CDATA.prototype.clone=function(){var v=new marknote.Cloner();return v.clone(this)};marknote.Cloner=function(){this.dataType=marknote.constants.DATATYPE_CLONER;this.isSw8tXmlContent=false};marknote.Cloner.prototype.cloneDocument=function(y){var A=new marknote.Document();var x=y.getProcessingInstructions();var w=y.getRootElement();var B;for(var z=0;z<x.length;z++){B=this.cloneProcessingInstruction(x[z]);A.addProcessingInstruction(B)}var v=this.cloneElement(w);A.setRootElement(v);return A};marknote.Cloner.prototype.cloneProcessingInstruction=function(x){var v=x.getData();var w=x.getTarget().slice(0);var y=this.cloneArray(v);return new marknote.ProcessingInstruction(w,y)};marknote.Cloner.prototype.cloneElement=function(z){var y=new marknote.Element();var w=z.getName().slice(0);var v=this.cloneArray(z.getAttributes());y.setName(w);y.setAttributes(v);if(z.isSelfTerminated){y.isSelfTerminated=true;return y}var x=this.cloneContents(z);y.setContents(x);return y};marknote.Cloner.prototype.cloneContents=function(z){var y=new Array();var v,w;for(var x=0;x<z.getContents().length;x++){var A=z.getContentAt(x);w=marknote.Util.dataType(A);switch(w){case marknote.constants.DATATYPE_ELEMENT:v=this.cloneElement(A);y.push(v);break;default:v=this.clone(A);y.push(v);break}}return y};marknote.Cloner.prototype.clone=function(x){var w=(x.dataType&&x.dataType.indexOf("marknote.")>0)||typeof x=="object";if(!w){return x}var y=new Object();for(var v in x){y[v]=this.clone(x[v])}return y};marknote.Cloner.prototype.cloneArray=function(y){var v=new Array();var x;for(var w=0;w<y.length;w++){x=this.clone(y[w]);v.push(x)}return v};marknote.Comment=function(v){this.dataType=marknote.constants.DATATYPE_COMMENT;this.isSw8tXmlContent=true;this.text=marknote.Util.erefEncode(marknote.Util.nothingToBlank(v))};marknote.Comment.prototype.getText=function(){return marknote.Util.erefDecode(marknote.Util.nothingToBlank(this.text))};marknote.Comment.prototype.setText=function(v){this.text=marknote.Util.erefEncode(marknote.Util.nothingToBlank(v))};marknote.Comment.prototype.clone=function(){var v=new marknote.Cloner();return v.clone(this)};marknote.FPI=function(z,v,x,w,y){this.registration=z;this.organization=v;this.publicTextClass=x;this.publicTextDescription=w;this.publicTextLanguage=y};marknote.FPI.prototype.getRegistration=function(){return this.registration};marknote.FPI.prototype.setRegistration=function(v){this.registration=v};marknote.FPI.prototype.getOrganization=function(){return this.organization};marknote.FPI.prototype.setOrganization=function(v){this.organziation=v};marknote.FPI.prototype.getPublicTextClass=function(){return this.publicTextClass};marknote.FPI.prototype.setPublicTextClass=function(v){this.publicTextClass=v};marknote.FPI.prototype.getPublicTextDescription=function(){return this.publicTextDescription};marknote.FPI.prototype.setPublicTextDescription=function(v){this.publicTextDescription=v};marknote.FPI.prototype.getPublicTextLanguage=function(){return this.publicTextLanguage};marknote.FPI.prototype.setPublicTextLanguage=function(v){this.publicTextLanguage=v};marknote.DOCTYPE=function(x,A,C,w,B){this.dataType=marknote.constants.DATATYPE_DOCTYPE;this.isSw8tXmlContent=false;if(x&&!A){var z=new String(x);var y=new marknote.Parser();var v=y.parseDOCTYPE(z);this.topElement=v.getTopElement();this.availability=v.getAvailability();this.FPI=v.getFPI();this.URL=v.getURL();this.internalSubset=v.getInternalSubset()}else{this.setTopElement(x);this.setAvailability(A);this.setFPI(C);this.setURL(w);this.setInternalSubset(B)}};marknote.DOCTYPE.prototype.getTopElement=function(){return this.topElement};marknote.DOCTYPE.prototype.setTopElement=function(v){this.topElement=v};marknote.DOCTYPE.prototype.getAvailability=function(){return this.availability};marknote.DOCTYPE.prototype.setAvailability=function(v){this.availability=v};marknote.DOCTYPE.prototype.getFPI=function(){return this.FPI};marknote.DOCTYPE.prototype.setFPI=function(v){this.FPI=v};marknote.DOCTYPE.prototype.getURL=function(){return this.URL};marknote.DOCTYPE.prototype.setURL=function(w){var v=marknote.Util.trim(w);if(v===""){this.URL="";return}if(v.charAt(0)!='"'){v='"'+v}if(v.charAt(v.length-1)!='"'){v+='"'}this.URL=v};marknote.DOCTYPE.prototype.getInternalSubset=function(){return this.internalSubset};marknote.DOCTYPE.prototype.setInternalSubset=function(v){this.dataType=marknote.constants.DATATYPE_DOCTYPE;this.internalSubset=v};marknote.Document=function(){this.dataType=marknote.constants.DATATYPE_DOCUMENT;this.isSw8tXmlContent=false;this.processingInstructions=new Array();this.rootElement=new marknote.Element();this.contents=new Array()};marknote.Document.prototype.getProcessingInstructions=function(){return this.processingInstructions};marknote.Document.prototype.setProcessingInstructions=function(v){this.processingInstructions=v};marknote.Document.prototype.addProcessingInstruction=function(v){this.processingInstructions.push(v)};marknote.Document.prototype.removeProcessingInstruction=function(x){for(var v=0;v<this.processingInstructions.length;v++){var w=this.processingInstructions[v].getTarget();if(w==x){marknote.Util.removeArrayItem(this.processingInstructions,v)}}};marknote.Document.prototype.getRootElement=function(){return this.rootElement};marknote.Document.prototype.setRootElement=function(v){if(!(v instanceof marknote.Element)){return}this.rootElement=v};marknote.Document.prototype.getDOCTYPE=function(){return this.DOCTYPE};marknote.Document.prototype.setDOCTYPE=function(v){this.DOCTYPE=v};marknote.Document.prototype.getBaseURI=function(){return this.baseURI};marknote.Document.prototype.setBaseURI=function(v){this.baseURI=v};marknote.Document.prototype.clone=function(){var v=new marknote.Cloner();return v.cloneDocument(this)};marknote.Element=function(v){this.dataType=marknote.constants.DATATYPE_ELEMENT;this.isSw8tXmlContent=true;this.contents=new Array();this.attributes=new Array();this.qname=new marknote.QName();this.isSelfTerminated=false;if(v){if(v instanceof marknote.QName){this.setQName(v)}else{this.setName(v)}}};marknote.Element.prototype.getName=function(){return this.qname.getName()};marknote.Element.prototype.setName=function(v){this.qname.setName(v)};marknote.Element.prototype.getQName=function(){return this.qname};marknote.Element.prototype.setQName=function(v){this.qname=v};marknote.Element.prototype.hasContents=function(){return this.contents&&this.contents.length>0};marknote.Element.prototype.getContents=function(){return this.contents};marknote.Element.prototype.getContentAt=function(v){return this.getContents()[v]};marknote.Element.prototype.addContent=function(v){if(v&&v.isSw8tXmlContent){this.getContents().push(v)}};marknote.Element.prototype.removeContent=function(v){marknote.Util.removeArrayItem(this.contents,v)};marknote.Element.prototype.setContents=function(v){this.contents=v};marknote.Element.prototype.getText=function(y){var x="";if(typeof y=="undefined"){y=true}for(var v=0;v<this.contents.length;v++){var z=this.getContentAt(v);var w=marknote.Util.dataType(z);if(w==marknote.constants.DATATYPE_TEXT){x+=z.getText(y)}else{if(w==marknote.constants.DATATYPE_CDATA){x+=z.getText()}}}return x};marknote.Element.prototype.setText=function(x){var w=new Array();for(var z=0;z<this.contents.length;z++){var y=this.getContentAt(z);var v=marknote.Util.dataType(y);if(v==marknote.constants.DATATYPE_COMMENT){w.push(y)}}this.contents=w;x=x?""+x:"";this.contents.push(new marknote.Text(x))};marknote.Element.prototype.setCDATAText=function(x){var w=new Array();for(var z=0;z<this.contents.length;z++){var y=this.getContentAt(z);var v=marknote.Util.dataType(y);if(v==marknote.constants.DATATYPE_COMMENT){w.push(y)}}this.contents=w;x=x?""+x:"";this.contents.push(new marknote.CDATA(x))};marknote.Element.prototype.removeText=function(){for(var v=this.contents.length-1;v>=0;v--){var x=this.getContentAt(v);var w=marknote.Util.dataType(x);if(w==marknote.constants.DATATYPE_TEXT||w==marknote.constants.DATATYPE_CDATA){marknote.Util.removeArrayItem(this.contents,v)}}};marknote.Element.prototype.getCommentText=function(){var x="";for(var v=0;v<this.contents.length;v++){var y=this.getContentAt(v);var w=marknote.Util.dataType(y);if(w==marknote.constants.DATATYPE_COMMENT){x+=y.getText()}}return x};marknote.Element.prototype.setCommentText=function(v){this.removeComments();v=v?""+v:"";this.addContent(new marknote.Comment(v))};marknote.Element.prototype.removeComments=function(){for(var v=this.contents.length-1;v>=0;v--){var x=this.getContentAt(v);var w=marknote.Util.dataType(x);if(w==marknote.constants.DATATYPE_COMMENT){marknote.Util.removeArrayItem(this.contents,v)}}};marknote.Element.prototype.addChildElement=function(v){var w=marknote.Util.dataType(v);if(!w==marknote.constants.DATATYPE_ELEMENT){return}this.getContents().push(v)};marknote.Element.prototype.removeChildElements=function(x){var y=0;if(!x){y=this.contents.length;this.contents=new Array();return y}var A=x.dataType==marknote.constants.DATATYPE_QNAME?x.getName():x;var z=marknote.Cloner.cloneArray(this.contents);for(var v=z.length-1;v>=0;v--){var w=marknote.Util.dataType(z[v]);if(w!=marknote.constants.DATATYPE_ELEMENT){continue}if(this.clonedContents[v].getName()==A){marknote.Util.removeArrayItem(this.contents,v);y++}}return y};marknote.Element.prototype.getChildElements=function(y){var A=false;var x=new Array();if(y){A=y.dataType==marknote.constants.DATATYPE_QNAME?y.getName():y}for(var v=0;v<this.contents.length;v++){var z=this.contents[v];var w=marknote.Util.dataType(z);if(w!=marknote.constants.DATATYPE_ELEMENT){continue}if(A){if(z.getName()==A){x.push(z)}}else{x.push(z)}}return x};marknote.Element.prototype.getChildElement=function(B){var v=B.dataType==marknote.constants.DATATYPE_QNAME?B.getName():B;if(v){var x=this.getContents();for(var y=0;y<x.length;y++){var z=x[y];var w=marknote.Util.dataType(z);if(w==marknote.constants.DATATYPE_ELEMENT){var A=z.getName();if(A===v){return z}}}}};marknote.Element.prototype.removeChildElement=function(B){var v=B.dataType==marknote.constants.DATATYPE_QNAME?B.getName():B;if(v){var x=this.getContents();for(var y=0;y<x.length;y++){var z=x[y];var w=marknote.Util.dataType(z);if(w==marknote.constants.DATATYPE_ELEMENT){var A=z.getName();if(A===v){marknote.Util.removeArrayItem(this.contents,y);return}}}}};marknote.Element.prototype.getAttributes=function(){return this.attributes};marknote.Element.prototype.setAttributes=function(v){this.attributes=v};marknote.Element.prototype.getAttribute=function(w){for(var v=0;v<this.getAttributes().length;v++){var x=this.getAttributes()[v];if(x.getName()==w){return x}}};marknote.Element.prototype.getAttributeValue=function(w){var v=this.getAttribute(w);return v?v.getValue():""};marknote.Element.prototype.getAttributeAt=function(v){return this.getAttributes()[v]};marknote.Element.prototype.setAttribute=function(w,x){if(marknote.Util.dataType(w)==marknote.constants.DATATYPE_ATTRIBUTE){this.putAttribute(w)}else{for(var v=0;v<this.getAttributes().length;v++){var y=this.getAttributes()[v];if(y.getName()==w){y.setValue(x);return}}this.putAttribute(new marknote.Attribute(w,x))}};marknote.Element.prototype.putAttribute=function(v){if(v&&this.getAttribute(v.getName())){this.removeAttribute(v.getName())}this.getAttributes().push(v)};marknote.Element.prototype.removeAttribute=function(w){var x=new Array();for(var v=0;v<this.getAttributes().length;v++){var y=this.getAttributes()[v];if(y.getName()!=w){x.push(y)}}this.setAttributes(x)};marknote.Element.prototype.removeAllAttributes=function(){this.setAttributes(new Array())};marknote.Element.prototype.clone=function(){var v=new marknote.Cloner();return v.cloneElement(this)};marknote.EntityRef=function(w,v){this.dataType=marknote.constants.DATATYPE_ENTITYREF;this.name=w;this.character=v};marknote.EntityRef.prototype.getName=function(){return this.name};marknote.EntityRef.prototype.setName=function(v){this.name=v};marknote.EntityRef.prototype.getName=function(){return this.name};marknote.EntityRef.prototype.setName=function(v){this.dataType=marknote.constants.DATATYPE_ENTITYREF;this.isSw8tXmlContent=false;this.character=v};marknote.EntityRef.prototype.clone=function(){var v=new marknote.Cloner();return v.clone(this)};marknote.XMLEntityRefs=function(){this.dataType=marknote.constants.DATATYPE_XMLENTITYREFS;this.isSw8tXmlContent=false;this.refs=new Array();this.pushRef("quot",34);this.pushRef("amp",38);this.pushRef("apos",39);this.pushRef("lt",60);this.pushRef("gt",62)};marknote.XMLEntityRefs.prototype.getRefs=function(){return this.refs};marknote.XMLEntityRefs.prototype.pushRef=function(v,w){this.refs.push(new marknote.EntityRef(v,String.fromCharCode(w)))};marknote.EntityRefs=function(){this.dataType=marknote.constants.DATATYPE_ENTITYREFS;this.isSw8tXmlContent=false;this.refs=new Array().concat(new marknote.XMLEntityRefs().getRefs())};marknote.EntityRefs.prototype.getRefs=function(){return this.refs};marknote.Parser=function(){this.dataType=marknote.constants.DATATYPE_PARSER;this.isSw8tXmlContent=false;this.doc=new marknote.Document();this.status=0;this.statusMessage="success"};marknote.Parser.prototype.getDocument=function(){return this.doc};marknote.Parser.prototype.getStatus=function(){return this.status};marknote.Parser.prototype.setStatus=function(v){this.status=v};marknote.Parser.prototype.getStatusMessage=function(){return this.statusMessage};marknote.Parser.prototype.setStatusMessage=function(v){this.statusMessage=v};marknote.Parser.prototype.parseProcessingInstructions=function(B,y){var w=new marknote.Tokenizer(B);var A=w.tokenize();var F=0,J=0;var K=false;var E,C,G,D,L,z,x;for(var v=0;v<A.length;v++){x=A[v].getType();switch(x){case marknote.constants.TOKENTYPE_PI_START:F=A[v].getPosition();C="";G=new Array();K=true;C=A[v+1].getContent();v++;break;case marknote.constants.TOKENTYPE_PI_END:if(K){if(marknote.Util.isUndefinedNullOrBlank(C)){C="xml"}}K=false;J=A[v].getPosition()+2;E=new marknote.ProcessingInstruction(C,G);y.addProcessingInstruction(E);break;case marknote.constants.TOKENTYPE_ATTRIBUTE:if(K){L=A[v-1].getContent();z=A[v+1].getContent();z=z.slice(1,z.length-1);D=new marknote.Attribute(L,z);G.push(D)}v++;break;default:break}}if(J>F){var H=F>0?B.slice(0,F):"";var I=B.slice(J+1);return marknote.Util.trim(H+I)}else{return B}};marknote.Parser.prototype.parseProcessingInstructions=function(B,y){var w=new marknote.Tokenizer(B);var A=w.tokenize();var F=0,J=0;var K=false;var E,C,G,D,L,z,x;for(var v=0;v<A.length;v++){x=A[v].getType();switch(x){case marknote.constants.TOKENTYPE_PI_START:F=A[v].getPosition();C="";G=new Array();K=true;C=A[v+1].getContent();v++;break;case marknote.constants.TOKENTYPE_PI_END:if(K){if(marknote.Util.isUndefinedNullOrBlank(C)){C="xml"}}K=false;J=A[v].getPosition()+2;E=new marknote.ProcessingInstruction(C,G);y.addProcessingInstruction(E);break;case marknote.constants.TOKENTYPE_ATTRIBUTE:if(K){L=A[v-1].getContent();z=A[v+1].getContent();z=z.slice(1,z.length-1);D=new marknote.Attribute(L,z);G.push(D)}v++;break;default:break}}if(J>F){var H=F>0?B.slice(0,F):"";var I=B.slice(J+1);return marknote.Util.trim(H+I)}else{return B}};marknote.Parser.prototype.parseDOCTYPE=function(A,y){var w=new marknote.Tokenizer(A);var z=w.tokenize();var B=new marknote.DOCTYPE();var x,C;try{for(var v=0;v<z.length;v++){x=z[v].getType();switch(x){case marknote.constants.TOKENTYPE_DOCTYPE_START:if(y){y.setDOCTYPE(B)}if(z[++v].isTagClose()){return B}B.setTopElement(z[v].getContent());C=z[++v].getContent().toUpperCase();B.setAvailability(C);if("SYSTEM"==C){if(z[++v].isTagClose()){return B}B.setURL(z[v].getContent())}else{if("PUBLIC"==C){if(z[++v].isTagClose()){return B}B.setFPI(z[v].getContent());if(z[++v].isTagClose()){return B}B.setURL(z[v].getContent());if(z[++v].isTagClose()){return B}B.setInternalSubset(z[v].getContent())}}break;case marknote.constants.TOKENTYPE_TAG_CLOSE:return B;default:break}}}catch(D){window.alert(D)}return B};marknote.Parser.prototype.parse=function(v){this.xhr=null;this.xhrStatus=null;this.xhrStatusText=null;this.xhrResponseText=null;this.doc=new marknote.Document();this.setStatus(0);v=this.parseProcessingInstructions(v,this.doc);this.parseDOCTYPE(v,this.doc);this.parseElement(v,this.doc);return this.doc};marknote.Parser.prototype.parseURL=function(w,y,x){var z=new marknote.SJAX();var v=z.read(w,y,x);this.xhr=z.getRequest();this.xhrStatus=z.getStatus();this.xhrStatusText=z.getStatusText();this.xhrResponseText=z.getResponseText();return v};marknote.Parser.prototype.parseComment=function(w,z,v){var y=z[v+1].content==marknote.constants.COMMENT_START?"":z[v+1].content;var x=new marknote.Comment(y);if(w){w.addContent(x)}v=z[v+1].content==marknote.constants.COMMENT_START?v+1:v+2;return v};marknote.Parser.prototype.parseElement=function(B,y,H){var G=new marknote.Tokenizer(B);var J=G.tokenize();var z=0,Q=0;var D=false;for(var L=0;L<J.length;L++){if(J[L].isCommentStart()){L=this.parseComment(H,J,L);continue}for(;L<J.length;L++){if(J[L].isTagOpen()){z=L;break}}if(z!=L){return}var A=new marknote.Element(J[z+1].content);if(!H){y.setRootElement(A)}else{H.addContent(A)}for(L=z+1;L<J.length;L++){switch(J[L].getType()){case marknote.constants.TOKENTYPE_SELF_TERMINATING:A.isSelfTerminated=true;z=L;break;case marknote.constants.TOKENTYPE_TAG_CLOSE:A.isSelfTerminated=false;z=L;break;case marknote.constants.TOKENTYPE_ATTRIBUTE:try{var T=J[L-1].content;var O=J[L+1].content;var I=O.slice(1,O.length-1);var M=new marknote.Attribute(T,I);A.putAttribute(M)}catch(P){}break;default:break}if(z==L){break}}if(!z==L){return}switch(J[z].content){case marknote.constants.TAG_CLOSE_SELF_TERMINATING:D=J[z+1]&&J[z+1].content==marknote.constants.COMMENT_START;if(D){Q=z+1;while(D){Q=this.parseComment(H,J,Q);D=J[Q+1]&&J[Q+1].content==marknote.constants.COMMENT_START;if(D){Q++}}}else{Q=z}break;case marknote.constants.TAG_CLOSE:if(J[z+1]){if(J[z+1].isCDATAStart()){var K=J[L+2].content;var C=L+3;if(J[L+2].isCDATAEnd()){K="";C=L+2}var U=new marknote.CDATA(K);A.addContent(U);z=C}else{if(J[z+1].isLiteral){A.setText(J[z+1].getContent())}}}else{Q=z}for(L=z+1;L<J.length;L++){var F=J[L].getContent()==marknote.constants.ENDTAG_OPEN&&J[L+1].getContent()==A.getName()?true:false;if(F){Q=L;D=J[Q+3]&&J[Q+3].content==marknote.constants.COMMENT_START;if(D){Q=this.parseComment(H,J,Q+3)}var E=Q==z+1||(J[z+1].isLiteral&&Q==z+2)?false:true;if(!E){break}var R=J[z+1].getPosition();var S=J[Q].getPosition();var N=B.slice(R,S);this.parseElement(N,y,A);break}}if(!F){return}break;default:return}L=Q}};marknote.ProcessingInstruction=function(v,w){this.dataType=marknote.constants.DATATYPE_PROCESSINGINSTRUCTION;this.isSw8tXmlContent=false;this.target=v?v:"xml";if(v&&!w){this.data=new Array()}else{if(!w){this.data=[new marknote.Attribute("version","1.0"),new marknote.Attribute("encoding","UTF-8")]}else{this.data=w}}};marknote.ProcessingInstruction.prototype.getData=function(){return this.data};marknote.ProcessingInstruction.prototype.setData=function(v){this.data=v};marknote.ProcessingInstruction.prototype.getTarget=function(){return this.target};marknote.ProcessingInstruction.prototype.setTarget=function(v){this.target=v};marknote.ProcessingInstruction.prototype.setAttribute=function(x){var w=this.getData();if(marknote.Util.dataType(x)==marknote.constants.DATATYPE_ATTRIBUTE){for(var v=0;v<w.length;v++){if(w[v].getName()==x.getName()){w[v].setValue(x.getValue());return}}}};marknote.ProcessingInstruction.prototype.getAttributeValue=function(x){var w=this.getData();for(var v=0;v<w.length;v++){if(w[v].getName()==x){return w[v]}}};marknote.ProcessingInstruction.prototype.setAttributeValue=function(y,w){var x=this.getData();if(y){if(typeof w=="undefined"){w=""}for(var v=0;v<x.length;v++){if(x[v].getName()==y){x[v].setValue(w);return}}x.push(new marknote.Attribute(y,w))}};marknote.ProcessingInstruction.prototype.clone=function(){var v=new marknote.Cloner();return v.cloneProcessingInstruction(this)};marknote.QName=function(v,w){this.dataType=marknote.constants.DATATYPE_QNAME;this.isSw8tXmlContent=false;this.prefix=marknote.Util.nothingToBlank(v);this.localPart=marknote.Util.nothingToBlank(w)};marknote.QName.prototype.getName=function(){var v="";if(marknote.Util.hasValue(this.prefix)){v+=this.prefix+":"}if(marknote.Util.hasValue(this.localPart)){v+=this.localPart}return v};marknote.QName.prototype.setName=function(v){var x=marknote.Util.nothingToBlank(v);var w=x.split(":");if(w.length>1){this.prefix=w[0];this.localPart=w[1]}else{this.prefix="";this.localPart=x}};marknote.QName.prototype.getPrefix=function(){return marknote.Util.nothingToBlank(this.prefix)};marknote.QName.prototype.setPrefix=function(v){this.prefix=marknote.Util.nothingToBlank(v)};marknote.QName.prototype.getLocalPart=function(){return marknote.Util.nothingToBlank(this.localPart)};marknote.QName.prototype.setLocalPart=function(v){this.localPart=marknote.Util.nothingToBlank(v)};marknote.QName.prototype.clone=function(){var v=new marknote.Cloner();return v.clone(this)};marknote.Text=function(v){this.dataType=marknote.constants.DATATYPE_TEXT;this.isSw8tXmlContent=true;this.text=marknote.Util.erefEncode(marknote.Util.nothingToBlank(v))};marknote.Text.prototype.getText=function(v){if(marknote.Util.isEmpty(v)){v=true}var w=marknote.Util.nothingToBlank(this.text);return v?marknote.Util.erefDecode(w):w};marknote.Text.prototype.setText=function(v){this.text=marknote.Util.erefEncode(marknote.Util.nothingToBlank(v))};marknote.Text.prototype.clone=function(){var v=new marknote.Cloner();return v.clone(this)};marknote.Token=function(v,w){this.dataType=marknote.constants.DATATYPE_TOKEN;this.isSwt8XmlContent=false;this.content=typeof(v)=="undefined"?new String():v;this.isLiteral=false;this.position=w?w:0};marknote.Token.prototype.getContent=function(){return this.content};marknote.Token.prototype.setContent=function(v){this.content=v};marknote.Token.prototype.getPosition=function(){return this.position};marknote.Token.prototype.setPosition=function(v){this.position=v};marknote.Token.prototype.hasValue=function(){try{return marknote.Util.hasValue(this.content)}catch(v){return false}};marknote.Token.prototype.isDOCTYPEStart=function(){return this.content==marknote.constants.DOCTYPE_START};marknote.Token.prototype.isPIStart=function(){return this.content==marknote.constants.PI_START};marknote.Token.prototype.isPIEnd=function(){return this.content==marknote.constants.PI_END};marknote.Token.prototype.isSelfTerminating=function(){return this.content==marknote.constants.TAG_CLOSE_SELF_TERMINATING};marknote.Token.prototype.isEndTag=function(){return this.content==marknote.constants.ENDTAG_OPEN};marknote.Token.prototype.isCommentStart=function(){return this.content==marknote.constants.COMMENT_START};marknote.Token.prototype.isCommentEnd=function(){return this.content==marknote.constants.COMMENT_END};marknote.Token.prototype.isAttribute=function(){return this.content==marknote.constants.EQUALS};marknote.Token.prototype.isCDATAStart=function(){return this.content==marknote.constants.CDATA_START};marknote.Token.prototype.isCDATAEnd=function(){return this.content==marknote.constants.CDATA_END};marknote.Token.prototype.isTagOpen=function(){return this.content==marknote.constants.TAG_OPEN};marknote.Token.prototype.isTagClose=function(){return this.content==marknote.constants.TAG_CLOSE};marknote.Token.prototype.isQuote=function(){return this.content==marknote.constants.SQUOTE||this.content==marknote.constants.DQUOTE};marknote.Token.prototype.isQuoted=function(){return this.content.charAt(0)=='"'&&this.content.charAt(this.content.length-1)=='"'};marknote.Token.prototype.getType=function(){if(this.isDOCTYPEStart()){return marknote.constants.TOKENTYPE_DOCTYPE_START}if(this.isPIStart()){return marknote.constants.TOKENTYPE_PI_START}if(this.isPIEnd()){return marknote.constants.TOKENTYPE_PI_END}if(this.isSelfTerminating()){return marknote.constants.TOKENTYPE_SELF_TERMINATING}if(this.isEndTag()){return marknote.constants.TOKENTYPE_ENDTAG_OPEN}if(this.isCommentStart()){return marknote.constants.TOKENTYPE_COMMENT_START}if(this.isCommentEnd()){return marknote.constants.TOKENTYPE_COMMENT_END}if(this.isAttribute()){return marknote.constants.TOKENTYPE_ATTRIBUTE}if(this.isCDATAStart()){return marknote.constants.TOKENTYPE_CDATA_START}if(this.isCDATAEnd()){return marknote.constants.TOKENTYPE_CDATA_END}if(this.isTagOpen()){return marknote.constants.TOKENTYPE_TAG_OPEN}if(this.isTagClose()){return marknote.constants.TOKENTYPE_TAG_CLOSE}if(this.isQuote()){return marknote.constants.TOKENTYPE_QUOTE}if(this.isQuoted()){return marknote.constants.TOKENTYPE_QUOTED}return marknote.constants.TOKENTYPE_NORMAL};marknote.Tokenizer=function(v){this.dataType=marknote.constants.DATATYPE_TOKENIZER;this.isSw8tXmlContent=false;this.setMarkup(v);this.tokens=new Array()};marknote.Tokenizer.prototype.getMarkup=function(){return this.markup};marknote.Tokenizer.prototype.setMarkup=function(v){this.markup=v?v:""};marknote.Tokenizer.prototype.determineTokenType=function(x,w){var v=this.markup.charAt(x);var y=x>0?this.markup.charAt(x-1):null;if(marknote.Util.hasWhitespace(v)){return marknote.constants.TOKENTYPE_WHITESPACE}if(this.markup.slice(x,x+9)==marknote.constants.DOCTYPE_START){return marknote.constants.TOKENTYPE_DOCTYPE_START}if(this.markup.slice(x,x+9)==marknote.constants.CDATA_START){return marknote.constants.TOKENTYPE_CDATA_START}if(this.markup.slice(x,x+4)==marknote.constants.COMMENT_START){return marknote.constants.TOKENTYPE_COMMENT_START}if(this.markup.slice(x,x+3)==marknote.constants.CDATA_END){return marknote.constants.TOKENTYPE_CDATA_END}if(this.markup.slice(x,x+2)==marknote.constants.PI_START){return marknote.constants.TOKENTYPE_PI_START}if(this.markup.slice(x,x+2)==marknote.constants.PI_END){return marknote.constants.TOKENTYPE_PI_END}if(this.markup.slice(x,x+2)==marknote.constants.TAG_CLOSE_SELF_TERMINATING){return marknote.constants.TOKENTYPE_SELF_TERMINATING}if(this.markup.slice(x,x+2)==marknote.constants.ENDTAG_OPEN){return marknote.constants.TOKENTYPE_ENDTAG_OPEN}if(v==marknote.constants.EQUALS&&w){return marknote.constants.TOKENTYPE_ATTRIBUTE}if(v==marknote.constants.TAG_OPEN){return marknote.constants.TOKENTYPE_TAG_OPEN}if(v==marknote.constants.TAG_CLOSE){return marknote.constants.TOKENTYPE_TAG_CLOSE}if(v==marknote.constants.SQUOTE){return marknote.constants.TOKENTYPE_QUOTE}if(v==marknote.constants.DQUOTE){if(y!==null||y!="\\"){return marknote.constants.TOKENTYPE_QUOTE}}if(v==marknote.constants.BRACKET_OPEN){return marknote.constants.TOKENTYPE_BRACKET_OPEN}return marknote.constants.TOKENTYPE_NORMAL};marknote.Tokenizer.prototype.isQuote=function(v){return v==marknote.constants.SQUOTE||v==marknote.constants.DQUOTE};marknote.Tokenizer.prototype.tokenizeTagContent=function(z,x){var w=false;var A,v;for(var y=x+1;y<this.markup.length;y++){if(this.markup.slice(y,y+9)==marknote.constants.CDATA_START){w=true;break}else{if(this.markup.charAt(y)==marknote.constants.TAG_OPEN){break}}}if(w){v=new marknote.Token(marknote.constants.CDATA_START,y);z.push(v);v=new marknote.Token("",y+9);v.isLiteral=true;A=marknote.constants.CDATA_END;for(x=y+9;x<this.markup.length;x++){if(this.markup.slice(x,x+3)==A){z.push(v);v=new marknote.Token(A,x);z.push(v);x+=2;v=new marknote.Token("",x+3);break}else{v.content+=this.markup.charAt(x)}}}else{v=new marknote.Token("",x+1);v.isLiteral=true}return{token:v,c:x}};marknote.Tokenizer.prototype.tokenize=function(){var x=new Array();this.tokens=x;var E=new marknote.Token();var F=false,H=false,D=false;var w,G,I,y;for(var z=0;z<this.markup.length;z++){var v=this.determineTokenType(z,F);switch(v){case marknote.constants.TOKENTYPE_DOCTYPE_START:H=true;if(E.hasValue()){x.push(E)}E=new marknote.Token(marknote.constants.DOCTYPE_START,z);z+=8;break;case marknote.constants.TOKENTYPE_BRACKET_OPEN:if(H){if(E.hasValue()){x.push(E)}E=new marknote.Token(this.markup.charAt(z),z);E.isLiteral=true;w=marknote.constants.BRACKET_CLOSE;for(++z;z<this.markup.length;z++){E.content+=this.markup.charAt(z);if(this.markup.charAt(z)==w){if(E.hasValue()){x.push(E)}E=new marknote.Token("",z+1);break}}}else{E.content+=this.markup.charAt(z)}break;case marknote.constants.TOKENTYPE_PI_START:var A;var C="";if(E.hasValue()){x.push(E)}E=new marknote.Token(marknote.constants.PI_START,z);x.push(E);G=z+2;F=true;for(z=G;z<this.markup.length;z++){A=this.determineTokenType(z,F);if(A==marknote.constants.TOKENTYPE_PI_END){C=this.markup.slice(G,z);if(marknote.Util.isUndefinedNullOrBlank(C)){C="xml"}E=new marknote.Token(C,z);x.push(E);E=new marknote.Token(marknote.constants.PI_END,z);x.push(E);F=false;break}else{if(A==marknote.constants.TOKENTYPE_WHITESPACE){if(C===""){C=this.markup.slice(G,z);if(marknote.Util.isUndefinedNullOrBlank(C)){C="xml"}E=new marknote.Token(C,z);x.push(E)}break}}}E=new marknote.Token("",z);break;case marknote.constants.TOKENTYPE_PI_END:E=new marknote.Token(marknote.constants.PI_END,z);x.push(E);F=false;z+=2;E=new marknote.Token("",z);break;case marknote.constants.TOKENTYPE_WHITESPACE:if(E.isLiteral){E.content+=this.markup.charAt(z);break}for(++z;z<this.markup.length;z++){if(marknote.Util.hasWhitespace(this.markup.charAt(z))){continue}else{if(E.hasValue()){x.push(E)}v=this.determineTokenType(z,F);if(v==marknote.constants.TOKENTYPE_NORMAL){I=this.markup.charAt(z);E=new marknote.Token(I,z)}else{z--;E=new marknote.Token("",z+1)}break}}break;case marknote.constants.TOKENTYPE_SELF_TERMINATING:case marknote.constants.TOKENTYPE_ENDTAG_OPEN:F=false;if(E.hasValue()){x.push(E)}E=new marknote.Token(this.markup.slice(z,z+2),z);if(E.hasValue()){x.push(E)}z++;E=new marknote.Token("",z+1);break;case marknote.constants.TOKENTYPE_TAG_CLOSE:F=false;H=false;if(E.hasValue()){x.push(E)}E=new marknote.Token(marknote.constants.TAG_CLOSE,z);x.push(E);var B=this.tokenizeTagContent(x,z);E=B.token;z=B.c;break;case marknote.constants.TOKENTYPE_ATTRIBUTE:case marknote.constants.TOKENTYPE_TAG_OPEN:if(this.markup.charAt(z)==marknote.constants.TAG_OPEN){F=true}if(E.hasValue()){x.push(E)}E=new marknote.Token(this.markup.charAt(z),z);if(E.hasValue()){x.push(E)}E=new marknote.Token("",z+1);break;case marknote.constants.TOKENTYPE_QUOTE:if(E.hasValue()){x.push(E)}E=new marknote.Token(this.markup.charAt(z),z);E.isLiteral=true;w=this.markup.charAt(z);for(++z;z<this.markup.length;z++){E.content+=this.markup.charAt(z);if(this.markup.charAt(z)==w){if(E.hasValue()){x.push(E)}E=new marknote.Token("",z+1);break}}break;case marknote.constants.TOKENTYPE_COMMENT_START:if(E.hasValue()){x.push(E)}E=new marknote.Token(marknote.constants.COMMENT_START,z);x.push(E);w=marknote.constants.COMMENT_END;G=z+4;for(z=G;z<this.markup.length;z++){if(this.markup.slice(z,z+3)==w){y=this.markup.slice(G,z);E=new marknote.Token(y,G);E.isLiteral=true;x.push(E);E=new marknote.Token(w,z);x.push(E);z=z+2;break}}E=new marknote.Token("",z);break;default:E.content+=this.markup.charAt(z);break}}if(E.hasValue()){x.push(E)}return x};marknote.Util=new Object();marknote.Util.hasWhitespace=function(y){if(typeof y=="undefined"||y===null){return false}var z=y+"";var w=new RegExp(/^\s+$/);for(var x=0;x<z.length;x++){var v=z.charAt(x);if(w.test(v)){return true}}return false};marknote.Util.isUndefinedNullOrBlank=function(v){return !marknote.Util.hasValue(v)};marknote.Util.isEmpty=marknote.Util.isUndefinedNullOrBlank;marknote.Util.nothingToBlank=function(v){return marknote.Util.isEmpty(v)?"":v};marknote.Util.isAllWhitespace=function(y){if(typeof(y)=="undefined"||y===null){return false}var v=y+"";for(var x=0;x<v.length;x++){var w=v.charAt(x);if(!marknote.Util.hasWhitespace(w)){return false}}return true};marknote.Util.hasValue=function(v){if(typeof v=="undefined"||v===null){return false}var w=v+"";return !(w.length===0||marknote.Util.isAllWhitespace(w))};marknote.Util.trim=function(v){var w=v+"";return w.replace(/^\s+|\s+$/g,"")};marknote.Util.leftTrim=function(v){var w=v+"";return w.replace(/^\s+/,"")};marknote.Util.rightTrim=function(v){var w=v+"";return w.replace(/\s+$/,"")};marknote.Util.splitByWhitespace=function(v){if(typeof v=="undefined"||v===null){return v}var w=marknote.Util.trim(v)+"";return w.split(/\s+/)};marknote.Util.removeArrayItem=function(x,w){try{for(var v=0;v<x.length;v++){if(v==w){x.splice(v,1)}}}catch(y){}return x};marknote.Util.dataType=function(v){return typeof v!="undefined"&&v!==null&&v.dataType&&typeof v.dataType=="string"&&v.dataType.length>9&&v.dataType.slice(0,9)=="marknote."?v.dataType:typeof v};marknote.Util.replaceAll=function(x,v,y){var w=x+"";var z=0;var A="";while(w.indexOf(v,z)!=-1){A+=w.substring(z,w.indexOf(v,z));A+=y;z=(w.indexOf(v,z)+v.length)}A+=x.substring(z,x.length);return A};marknote.Util.erefEncode=function(v){var w=v+"";return marknote.Util.erefTransform(w,true)};marknote.Util.erefXMLEncode=function(v){var w=v+"";return marknote.Util.erefTransform(w,true,true)};marknote.Util.erefDecode=function(v){var w=v+"";return marknote.Util.erefTransform(w,false)};marknote.Util.erefXMLDecode=function(v){var w=v+"";return marknote.Util.erefTransform(w,false,true)};marknote.Util.erefTransform=function(z,w,v){var y=v?new marknote.XMLEntityRefs().getRefs():new marknote.EntityRefs().getRefs();var C=new String();C+=z;for(var B=0;B<y.length;B++){var D="&"+y[B].name+";";var E=y[B].character;var x=w?E:D;var A=w?D:E;C=marknote.Util.replaceAll(C,x,A)}return marknote.Util.replaceAll(C,"&quot;",'"')};var t=u.data.file,s=new FileReader();s.onload=function(E){var v=new marknote.Parser(),B,A,L,D=0,I,y,w,H,x=0,J,z=0,C,F,G,K=[];B=v.parse(E.target.result);y=B.getRootElement().getChildElements("trk");for(I=y.length;D<I;D++){L=y[D];H=L.getChildElements("trkseg");for(J=H.length;x<J;x++){A=H[x].getChildElements("trkpt");C=A.length;for(;z<C;z++){F=A[z].getAttribute("lat").getValue();G=A[z].getAttribute("lon").getValue();K.push({latitude:F,longitude:G})}}}self.postMessage(K);self.close()};s.readAsText(t)}r.append("self.addEventListener('message', ");r.append(n.valueOf());r.append(", false);");q=new Worker(o(r.getBlob()));q.postMessage({file:p[0]});c.innerText="Reading the file...";q.addEventListener("message",function(t){var s=t.data;if(s&&s.length&&s.length>0){mapController.renderActivityPoints(s);$("#changesMade").val(true);e("Race map successfully edited.")}else{e("No point found in your gpx file. Race map not edited.")}},false)}function h(k){k.stopPropagation();k.preventDefault();k.dataTransfer.dropEffect="copy"}})();}

          document.getElementById("bk").href = "javascript:(" + bk.valueOf() + "());";
        </script>

<h3>Testimonials</h3>

<ul>
  <li>Amazing! Works like a sharm! &mdash; <a href="http://support.runkeeper.com/discussions/questions/2878-create-new-race-map-from-activityroute#comment_17209020">Bjornar</a>&nbsp;<ins datetime="2012-08-03">(link broken since last Runkeeper support platform migration)</ins></li>
   <li><ins datetime="2012-08-03">this is phenomenal! I was trying to create a 5.7 mile trail race and it was impossible to get it all correct. Your bookmarklet worked like a champ! Thanks! &mdash; <a href="http://support.runkeeper.com/entries/21704641-editing-a-race-s-map-using-a-gpx-file?page=1#post_21712432">Hollis</a></ins></li>
</ul>

<h3>Support or Contact</h3>

<p>Having trouble? Ping me directly on twitter (<a href="https://twitter.com/jacqueminv">@jacqueminv</a>) or fill an <a href="https://github.com/jacqueminv/rkrace-bookmarklet/issues">issue on github</a>.</p>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
  </body>
</html>
