<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="google-site-verification" content="UwKGxpqrRZFVMqFaO1V0FKTvTjb0d-nwnEZwCIw3T_8" />
    <title>Rkrace-bookmarklet by jacqueminv</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style>
      #bk {
        display: block;
        height: 3em;
        text-align: center;
        padding: 1.5em 0 0;
        margin: 0 0 1em;
        background-color: #eee;
        border-radius: 1em;
      }

      ins {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>RKrace-bookmarklet</h1>
        <p>Edit a race map on Runkeeper simply by droping a gpx file.</p>

        <p class="view"><a href="https://github.com/jacqueminv/rkrace-bookmarklet">View the Project on GitHub <small>jacqueminv/rkrace-bookmarklet</small></a></p>

      </header>
      <section>
        <h3>Editing a race map, one click away</h3>

        <p>Being a fan of Runkeeper since a while I was annoyed by their race map creation workflow. You have to provide the race map and this is possible only by manually setting points. This can take minutes if not hours for some races and it can be hard to be precise (e.g. trail races anybody?).</p>

        <p>The little hacker deep inside me kept urging me to have a try fixing this. Here comes my bookmarklet.</p>

        <p>Drag and drop the following link in your bookmarks. Next time you want to edit a race on Runkeeper, simply click this bookmark and a small box asking you to provide a <code>gpx</code> file will appear. Drag and drop the race file and the process will start. This can take a while depending on your browser and available resources as everything is done in the browser. Nothing is sent or tracked from this bookmarklet. The code is open feel free to check.</p>

        <p>Note this was purposed for race maps at first but it actually works for any activity map found on Runkeeper.</p>

        <p><ins datetime="2014-12-30">Tracks and routes gpx formats are supported.</ins></p>

        <a id="bk" href="">
          rkrace-bookmarklet
        </a>

        <script>
          function bk(){javascript:(function(f){window.type={none:0};var c=document.createElement("div");c.innerHTML="Drop the gpx race file here.";c.setAttribute("style","font: bold 0.8em Arial; width:13em; padding: 14.5em 0 1em 0; background: url('data:image/png;base64,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') #EAEAEA no-repeat; position: fixed; top: 1em; left: 1em; z-index: 99999; text-align: center;");c.addEventListener("dragover",h,false);c.addEventListener("drop",a,false);document.body.appendChild(c);var b=document.createElement("div"),d=("draggable" in b)||("ondragstart" in b&&"ondrop" in b),k=window.URL||window.webkitURL,i,g=function(e){c.innerHTML=e||"";setTimeout(function(){c.parentElement.removeChild(c)},2000)};try{i=!!new Blob()}catch(j){i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder}if(!(d&&k&&i&&Worker&&FileReader)){g("You need a more recent browser");return}if(!window.mapController){g("Either you're not on RK race edition page, or RK made modifications to the code.");return}function a(m){m.stopPropagation();m.preventDefault();var p=m.dataTransfer.files,s,r,n,o,l=new FileReader();if(p.length!==1||p[0].size&&p[0].size>5242880){alert("Please give only one file (max size accepted: 5mb)");return}o=function(x){var w,v,A,z,u;w=function(){};w.constants={DOCTYPE_START:"<!DOCTYPE",CDATA_START:"<![CDATA[",CDATA_END:"]]>",COMMENT_START:"<!--",COMMENT_END:"-->",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSE_SELF_TERMINATING:"/>",ENDTAG_OPEN:"</",EQUALS:"=",SQUOTE:"'",DQUOTE:'"',PI_START:"<?",PI_END:"?>",BRACKET_OPEN:"[",BRACKET_CLOSE:"]",TOKENTYPE_BRACKET_OPEN:"bracketOpen",TOKENTYPE_TAG_OPEN:"tagOpen",TOKENTYPE_TAG_CLOSE:"tagClose",TOKENTYPE_ENDTAG_OPEN:"endTagOpen",TOKENTYPE_ENDTAG_CLOSE:"endTagClose",TOKENTYPE_SELF_TERMINATING:"closeTagSelfTerminating",TOKENTYPE_WHITESPACE:"whitespace",TOKENTYPE_ATTRIBUTE:"attribute",TOKENTYPE_QUOTE:"quote",TOKENTYPE_QUOTED:"quotedLiteral",TOKENTYPE_NORMAL:"normal",TOKENTYPE_COMMENT_START:"commentStart",TOKENTYPE_COMMENT_END:"commentEnd",TOKENTYPE_CDATA_START:"cdataStart",TOKENTYPE_CDATA_END:"cdataEnd",TOKENTYPE_PI_START:"piStart",TOKENTYPE_PI_END:"piEnd",TOKENTYPE_DOCTYPE_START:"docTypeStart",DATATYPE_ATTRIBUTE:"marknote.Attribute",DATATYPE_CDATA:"marknote.CDATA",DATATYPE_CLONER:"marknote.Cloner",DATATYPE_COMMENT:"marknote.Comment",DATATYPE_DOCTYPE:"marknote.DOCTYPE",DATATYPE_DOCUMENT:"marknote.Document",DATATYPE_ELEMENT:"marknote.Element",DATATYPE_ENTITYREF:"marknote.EntityRef",DATATYPE_XMLENTITYREFS:"marknote.XMLEntityRefs",DATATYPE_ENTITYREFS:"marknote.EntityRefs",DATATYPE_PARSER:"marknote.Parser",DATATYPE_PROCESSINGINSTRUCTION:"marknote.ProcessingInstruction",DATATYPE_QNAME:"marknote.QName",DATATYPE_TEXT:"marknote.Text",DATATYPE_TOKEN:"marknote.Token",DATATYPE_TOKENIZER:"marknote.Tokenizer",DATATYPE_WRITER:"marknote.Writer"};w.ajaxDoc=null;w.AJAX=function(){this.req=null;this.status=null;this.statusText=null;this.responseText=null};w.AJAX.prototype.genRequest=function(){var D=false;try{D=new XMLHttpRequest()}catch(E){try{D=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{D=new ActiveXObject("Microsoft.XMLHTTP")}catch(C){D=false}}}this.req=D;return D};w.AJAX.prototype.getRequest=function(){return this.req};w.AJAX.prototype.getStatus=function(){return this.status};w.AJAX.prototype.getStatusText=function(){return this.statusText};w.AJAX.prototype.getResponseText=function(){return this.responseText};w.AJAX.prototype.constructQueryString=function(D){var E="";if(D&&typeof D=="object"){var C="";for(var e in D){E+=C+encodeURIComponent(e)+"="+encodeURIComponent(D[e]);C="&"}}else{if(D&&typeof D=="string"){E=D}}return E};w.AJAX.prototype.read=function(J,I,D,G,K){var F=this.genRequest();var C=this;var H=this.constructQueryString(I);var E;w.AJAXDoc=null;K=K&&K.toUpperCase()==="POST"?"POST":"GET";if(!F){return false}if(!D){D=w.AJAX.defaultCallback}if(!G){G=new Object()}F.open(K,J,true);F.setRequestHeader("Content-Type","application/x-www-form-urlencoded");F.onreadystatechange=function(){if(F.readyState==4){C.status=F.status;C.statusText=F.statusText;C.responseText=F.responseText;var e=new w.Parser();E=e.parse(F.responseText);D.call(C,E,G)}};F.send(H)};w.AJAX.prototype.defaultCallback=function(C,e){w.AJAXDoc=C};w.SJAX=function(){this.req=null;this.status=null;this.statusText=null;this.responseText=null};w.SJAX.prototype.getRequest=function(){return this.req};w.SJAX.prototype.getStatus=function(){return this.status};w.SJAX.prototype.getStatusText=function(){return this.statusText};w.SJAX.prototype.getResponseText=function(){return this.responseText};w.SJAX.prototype.read=function(D,G,E){var H=new w.AJAX();var C=H.genRequest();var I=H.constructQueryString(G);var F=new w.Parser();E=E&&E.toUpperCase()==="POST"?"POST":"GET";if(!C){return new w.Document()}C.open(E,D,false);C.setRequestHeader("Content-Type","application/x-www-form-urlencoded");C.send(I);this.req=C;this.status=C.status;this.statusText=C.statusText;this.responseText=C.responseText;return F.parse(C.responseText)};w.Attribute=function(C,e){this.dataType=w.constants.DATATYPE_ATTRIBUTE;this.isSw8tXmlContent=false;this.name=C;this.value=w.Util.erefEncode(w.Util.nothingToBlank(e))};w.Attribute.prototype.getName=function(){return this.name};w.Attribute.prototype.setName=function(e){this.name=e};w.Attribute.prototype.getValue=function(){return w.Util.erefDecode(w.Util.nothingToBlank(this.value))};w.Attribute.prototype.setValue=function(e){this.value=w.Util.erefEncode(w.Util.nothingToBlank(e))};w.Attribute.prototype.toString=function(){return this.getName()+'="'+this.getValue()+'"'};w.Attribute.prototype.clone=function(){return new w.Attribute(this.getName(),this.getValue())};w.CDATA=function(e){this.dataType=w.constants.DATATYPE_CDATA;this.isSw8tXmlContent=true;this.text=w.Util.nothingToBlank(e)};w.CDATA.prototype.getText=function(){return w.Util.nothingToBlank(this.text)};w.CDATA.prototype.setText=function(e){this.text=w.Util.nothingToBlank(e)};w.CDATA.prototype.toString=function(){return this.getText()};w.CDATA.prototype.clone=function(){var e=new w.Cloner();return e.clone(this)};w.Cloner=function(){this.dataType=w.constants.DATATYPE_CLONER;this.isSw8tXmlContent=false};w.Cloner.prototype.cloneDocument=function(F){var H=new w.Document();var E=F.getProcessingInstructions();var D=F.getRootElement();var I;for(var G=0;G<E.length;G++){I=this.cloneProcessingInstruction(E[G]);H.addProcessingInstruction(I)}var C=this.cloneElement(D);H.setRootElement(C);return H};w.Cloner.prototype.cloneProcessingInstruction=function(D){var e=D.getData();var C=D.getTarget().slice(0);var E=this.cloneArray(e);return new w.ProcessingInstruction(C,E)};w.Cloner.prototype.cloneElement=function(G){var F=new w.Element();var D=G.getName().slice(0);var C=this.cloneArray(G.getAttributes());F.setName(D);F.setAttributes(C);if(G.isSelfTerminated){F.isSelfTerminated=true;return F}var E=this.cloneContents(G);F.setContents(E);return F};w.Cloner.prototype.cloneContents=function(G){var F=new Array();var C,D;for(var E=0;E<G.getContents().length;E++){var H=G.getContentAt(E);D=w.Util.dataType(H);switch(D){case w.constants.DATATYPE_ELEMENT:C=this.cloneElement(H);F.push(C);break;default:C=this.clone(H);F.push(C);break}}return F};w.Cloner.prototype.clone=function(D){var C=(D.dataType&&D.dataType.indexOf("marknote.")>0)||typeof D=="object";if(!C){return D}var E=new Object();for(var e in D){E[e]=this.clone(D[e])}return E};w.Cloner.prototype.cloneArray=function(E){var e=new Array();var D;for(var C=0;C<E.length;C++){D=this.clone(E[C]);e.push(D)}return e};w.Comment=function(e){this.dataType=w.constants.DATATYPE_COMMENT;this.isSw8tXmlContent=true;this.text=w.Util.erefEncode(w.Util.nothingToBlank(e))};w.Comment.prototype.getText=function(){return w.Util.erefDecode(w.Util.nothingToBlank(this.text))};w.Comment.prototype.setText=function(e){this.text=w.Util.erefEncode(w.Util.nothingToBlank(e))};w.Comment.prototype.toString=function(){return this.getText()};w.Comment.prototype.clone=function(){var e=new w.Cloner();return e.clone(this)};w.FPI=function(G,C,E,D,F){this.registration=G;this.organization=C;this.publicTextClass=E;this.publicTextDescription=D;this.publicTextLanguage=F};w.FPI.prototype.toString=function(){return'"'+this.getRegistration()+"//"+this.getOrganization()+"//"+this.getPublicTextClass()+" "+this.getPublicTextDescription()+"//"+this.getPublicTextLanguage()+'"'};w.FPI.prototype.getRegistration=function(){return this.registration};w.FPI.prototype.setRegistration=function(e){this.registration=e};w.FPI.prototype.getOrganization=function(){return this.organization};w.FPI.prototype.setOrganization=function(e){this.organziation=e};w.FPI.prototype.getPublicTextClass=function(){return this.publicTextClass};w.FPI.prototype.setPublicTextClass=function(e){this.publicTextClass=e};w.FPI.prototype.getPublicTextDescription=function(){return this.publicTextDescription};w.FPI.prototype.setPublicTextDescription=function(e){this.publicTextDescription=e};w.FPI.prototype.getPublicTextLanguage=function(){return this.publicTextLanguage};w.FPI.prototype.setPublicTextLanguage=function(e){this.publicTextLanguage=e};w.DOCTYPE=function(E,H,J,D,I){this.dataType=w.constants.DATATYPE_DOCTYPE;this.isSw8tXmlContent=false;if(E&&!H){var G=new String(E);var F=new w.Parser();var C=F.parseDOCTYPE(G);this.topElement=C.getTopElement();this.availability=C.getAvailability();this.FPI=C.getFPI();this.URL=C.getURL();this.internalSubset=C.getInternalSubset()}else{this.setTopElement(E);this.setAvailability(H);this.setFPI(J);this.setURL(D);this.setInternalSubset(I)}};w.DOCTYPE.prototype.toString=function(){var D=this.getAvailability()=="PUBLIC"&&this.getFPI()?" "+this.getFPI():"";var C=this.getURL()?" "+this.getURL():"";var e=this.getInternalSubset()?" "+this.getInternalSubset():"";return"<!DOCTYPE "+this.getTopElement()+" "+this.getAvailability()+D+C+e+">"};w.DOCTYPE.prototype.getTopElement=function(){return this.topElement};w.DOCTYPE.prototype.setTopElement=function(e){this.topElement=e};w.DOCTYPE.prototype.getAvailability=function(){return this.availability};w.DOCTYPE.prototype.setAvailability=function(e){this.availability=e};w.DOCTYPE.prototype.getFPI=function(){return this.FPI};w.DOCTYPE.prototype.setFPI=function(e){this.FPI=e};w.DOCTYPE.prototype.getURL=function(){return this.URL};w.DOCTYPE.prototype.setURL=function(C){var e=w.Util.trim(C);if(e===""){this.URL="";return}if(e.charAt(0)!='"'){e='"'+e}if(e.charAt(e.length-1)!='"'){e+='"'}this.URL=e};w.DOCTYPE.prototype.getInternalSubset=function(){return this.internalSubset};w.DOCTYPE.prototype.setInternalSubset=function(e){this.dataType=w.constants.DATATYPE_DOCTYPE;this.internalSubset=e};w.Document=function(){this.dataType=w.constants.DATATYPE_DOCUMENT;this.isSw8tXmlContent=false;this.processingInstructions=new Array();this.rootElement=new w.Element();this.contents=new Array()};w.Document.prototype.getProcessingInstructions=function(){return this.processingInstructions};w.Document.prototype.setProcessingInstructions=function(e){this.processingInstructions=e};w.Document.prototype.addProcessingInstruction=function(e){this.processingInstructions.push(e)};w.Document.prototype.removeProcessingInstruction=function(D){for(var e=0;e<this.processingInstructions.length;e++){var C=this.processingInstructions[e].getTarget();if(C==D){w.Util.removeArrayItem(this.processingInstructions,e)}}};w.Document.prototype.getRootElement=function(){return this.rootElement};w.Document.prototype.setRootElement=function(e){if(!(e instanceof w.Element)){return}this.rootElement=e};w.Document.prototype.getDOCTYPE=function(){return this.DOCTYPE};w.Document.prototype.setDOCTYPE=function(e){this.DOCTYPE=e};w.Document.prototype.getBaseURI=function(){return this.baseURI};w.Document.prototype.setBaseURI=function(e){this.baseURI=e};w.Document.prototype.toString=function(D,C,E,F){var G=new w.Writer();return G.outputDocument(this,D)};w.Document.prototype.clone=function(){var e=new w.Cloner();return e.cloneDocument(this)};w.Element=function(e){this.dataType=w.constants.DATATYPE_ELEMENT;this.isSw8tXmlContent=true;this.contents=new Array();this.attributes=new Array();this.qname=new w.QName();this.isSelfTerminated=false;if(e){if(e instanceof w.QName){this.setQName(e)}else{this.setName(e)}}};w.Element.prototype.getName=function(){return this.qname.getName()};w.Element.prototype.setName=function(e){this.qname.setName(e)};w.Element.prototype.getQName=function(){return this.qname};w.Element.prototype.setQName=function(e){this.qname=e};w.Element.prototype.hasContents=function(){return this.contents&&this.contents.length>0};w.Element.prototype.getContents=function(){return this.contents};w.Element.prototype.getContentAt=function(e){return this.getContents()[e]};w.Element.prototype.addContent=function(e){if(e&&e.isSw8tXmlContent){this.getContents().push(e)}};w.Element.prototype.removeContent=function(e){w.Util.removeArrayItem(this.contents,e)};w.Element.prototype.setContents=function(e){this.contents=e};w.Element.prototype.getText=function(F){var E="";if(typeof F=="undefined"){F=true}for(var C=0;C<this.contents.length;C++){var G=this.getContentAt(C);var D=w.Util.dataType(G);if(D==w.constants.DATATYPE_TEXT){E+=G.getText(F)}else{if(D==w.constants.DATATYPE_CDATA){E+=G.getText()}}}return E};w.Element.prototype.setText=function(E){var D=new Array();for(var G=0;G<this.contents.length;G++){var F=this.getContentAt(G);var C=w.Util.dataType(F);if(C==w.constants.DATATYPE_COMMENT){D.push(F)}}this.contents=D;E=E?""+E:"";this.contents.push(new w.Text(E))};w.Element.prototype.setCDATAText=function(E){var D=new Array();for(var G=0;G<this.contents.length;G++){var F=this.getContentAt(G);var C=w.Util.dataType(F);if(C==w.constants.DATATYPE_COMMENT){D.push(F)}}this.contents=D;E=E?""+E:"";this.contents.push(new w.CDATA(E))};w.Element.prototype.removeText=function(){for(var e=this.contents.length-1;e>=0;e--){var D=this.getContentAt(e);var C=w.Util.dataType(D);if(C==w.constants.DATATYPE_TEXT||C==w.constants.DATATYPE_CDATA){w.Util.removeArrayItem(this.contents,e)}}};w.Element.prototype.getCommentText=function(){var D="";for(var e=0;e<this.contents.length;e++){var E=this.getContentAt(e);var C=w.Util.dataType(E);if(C==w.constants.DATATYPE_COMMENT){D+=E.getText()}}return D};w.Element.prototype.setCommentText=function(e){this.removeComments();e=e?""+e:"";this.addContent(new w.Comment(e))};w.Element.prototype.removeComments=function(){for(var e=this.contents.length-1;e>=0;e--){var D=this.getContentAt(e);var C=w.Util.dataType(D);if(C==w.constants.DATATYPE_COMMENT){w.Util.removeArrayItem(this.contents,e)}}};w.Element.prototype.addChildElement=function(e){var C=w.Util.dataType(e);if(!C==w.constants.DATATYPE_ELEMENT){return}this.getContents().push(e)};w.Element.prototype.removeChildElements=function(E){var F=0;if(!E){F=this.contents.length;this.contents=new Array();return F}var H=E.dataType==w.constants.DATATYPE_QNAME?E.getName():E;var G=w.Cloner.cloneArray(this.contents);for(var C=G.length-1;C>=0;C--){var D=w.Util.dataType(G[C]);if(D!=w.constants.DATATYPE_ELEMENT){continue}if(this.clonedContents[C].getName()==H){w.Util.removeArrayItem(this.contents,C);F++}}return F};w.Element.prototype.getChildElements=function(F){var H=false;var E=new Array();if(F){H=F.dataType==w.constants.DATATYPE_QNAME?F.getName():F}for(var C=0;C<this.contents.length;C++){var G=this.contents[C];var D=w.Util.dataType(G);if(D!=w.constants.DATATYPE_ELEMENT){continue}if(H){if(G.getName()==H){E.push(G)}}else{E.push(G)}}return E};w.Element.prototype.getChildElement=function(I){var C=I.dataType==w.constants.DATATYPE_QNAME?I.getName():I;if(C){var E=this.getContents();for(var F=0;F<E.length;F++){var G=E[F];var D=w.Util.dataType(G);if(D==w.constants.DATATYPE_ELEMENT){var H=G.getName();if(H===C){return G}}}}};w.Element.prototype.removeChildElement=function(I){var C=I.dataType==w.constants.DATATYPE_QNAME?I.getName():I;if(C){var E=this.getContents();for(var F=0;F<E.length;F++){var G=E[F];var D=w.Util.dataType(G);if(D==w.constants.DATATYPE_ELEMENT){var H=G.getName();if(H===C){w.Util.removeArrayItem(this.contents,F);return}}}}};w.Element.prototype.getChildElementAt=function(C){try{return this.getChildElements()[C]}catch(e){}};w.Element.prototype.removeChildElementAt=function(D){var E=-1;var C;for(var F=0;F<this.contents.length;F++){C=w.Util.dataType(this.contents[F])==w.constants.DATATYPE_ELEMENT;if(C){E++;if(D==E){w.Util.removeArrayItem(this.contents,F);return}}}};w.Element.prototype.getAttributes=function(){return this.attributes};w.Element.prototype.setAttributes=function(e){this.attributes=e};w.Element.prototype.getAttribute=function(C){for(var e=0;e<this.getAttributes().length;e++){var D=this.getAttributes()[e];if(D.getName()==C){return D}}};w.Element.prototype.getAttributeValue=function(C){var e=this.getAttribute(C);return e?e.getValue():""};w.Element.prototype.getAttributeAt=function(e){return this.getAttributes()[e]};w.Element.prototype.setAttribute=function(C,D){if(w.Util.dataType(C)==w.constants.DATATYPE_ATTRIBUTE){this.putAttribute(C)}else{for(var e=0;e<this.getAttributes().length;e++){var E=this.getAttributes()[e];if(E.getName()==C){E.setValue(D);return}}this.putAttribute(new w.Attribute(C,D))}};w.Element.prototype.putAttribute=function(e){if(e&&this.getAttribute(e.getName())){this.removeAttribute(e.getName())}this.getAttributes().push(e)};w.Element.prototype.removeAttribute=function(C){var D=new Array();for(var e=0;e<this.getAttributes().length;e++){var E=this.getAttributes()[e];if(E.getName()!=C){D.push(E)}}this.setAttributes(D)};w.Element.prototype.removeAllAttributes=function(){this.setAttributes(new Array())};w.Element.prototype.toString=function(C){var e=new w.Writer();return e.outputElement(this,0,C)};w.Element.prototype.clone=function(){var e=new w.Cloner();return e.cloneElement(this)};w.EntityRef=function(C,e){this.dataType=w.constants.DATATYPE_ENTITYREF;this.name=C;this.character=e};w.EntityRef.prototype.getName=function(){return this.name};w.EntityRef.prototype.setName=function(e){this.name=e};w.EntityRef.prototype.getName=function(){return this.name};w.EntityRef.prototype.setName=function(e){this.dataType=w.constants.DATATYPE_ENTITYREF;this.isSw8tXmlContent=false;this.character=e};w.EntityRef.prototype.clone=function(){var e=new w.Cloner();return e.clone(this)};w.XMLEntityRefs=function(){this.dataType=w.constants.DATATYPE_XMLENTITYREFS;this.isSw8tXmlContent=false;this.refs=new Array();this.pushRef("quot",34);this.pushRef("amp",38);this.pushRef("apos",39);this.pushRef("lt",60);this.pushRef("gt",62)};w.XMLEntityRefs.prototype.getRefs=function(){return this.refs};w.XMLEntityRefs.prototype.pushRef=function(e,C){this.refs.push(new w.EntityRef(e,String.fromCharCode(C)))};w.EntityRefs=function(){this.dataType=w.constants.DATATYPE_ENTITYREFS;this.isSw8tXmlContent=false;this.refs=new Array().concat(new w.XMLEntityRefs().getRefs());this.pushRef("nbsp",160);this.pushRef("iexcl",161);this.pushRef("cent",162);this.pushRef("pound",163);this.pushRef("curren",164);this.pushRef("yen",165);this.pushRef("brvbar",166);this.pushRef("sect",167);this.pushRef("uml",168);this.pushRef("copy",169);this.pushRef("ordf",170);this.pushRef("laquo",171);this.pushRef("not",172);this.pushRef("shy",173);this.pushRef("reg",174);this.pushRef("macr",175);this.pushRef("deg",176);this.pushRef("plusmn",177);this.pushRef("sup2",178);this.pushRef("sup3",179);this.pushRef("acute",180);this.pushRef("micro",181);this.pushRef("para",182);this.pushRef("middot",183);this.pushRef("cedil",184);this.pushRef("sup1",185);this.pushRef("ordm",186);this.pushRef("raquo",187);this.pushRef("frac14",188);this.pushRef("frac12",189);this.pushRef("frac34",190);this.pushRef("iquest",191);this.pushRef("Agrave",192);this.pushRef("Aacute",193);this.pushRef("Acirc",194);this.pushRef("Atilde",195);this.pushRef("Auml",196);this.pushRef("Aring",197);this.pushRef("AElig",198);this.pushRef("Ccedil",199);this.pushRef("Egrave",200);this.pushRef("Eacute",201);this.pushRef("Ecirc",202);this.pushRef("Euml",203);this.pushRef("Igrave",204);this.pushRef("Iacute",205);this.pushRef("Icirc",206);this.pushRef("Iuml",207);this.pushRef("ETH",208);this.pushRef("Ntilde",209);this.pushRef("Ograve",210);this.pushRef("Oacute",211);this.pushRef("Ocirc",212);this.pushRef("Otilde",213);this.pushRef("Ouml",214);this.pushRef("times",215);this.pushRef("Oslash",216);this.pushRef("Ugrave",217);this.pushRef("Uacute",218);this.pushRef("Ucirc",219);this.pushRef("Uuml",220);this.pushRef("Yacute",221);this.pushRef("THORN",222);this.pushRef("szlig",223);this.pushRef("agrave",224);this.pushRef("aacute",225);this.pushRef("acirc",226);this.pushRef("atilde",227);this.pushRef("auml",228);this.pushRef("aring",229);this.pushRef("aelig",230);this.pushRef("ccedil",231);this.pushRef("egrave",232);this.pushRef("eacute",233);this.pushRef("ecirc",234);this.pushRef("euml",235);this.pushRef("igrave",236);this.pushRef("iacute",237);this.pushRef("icirc",238);this.pushRef("iuml",239);this.pushRef("eth",240);this.pushRef("ntilde",241);this.pushRef("ograve",242);this.pushRef("oacute",243);this.pushRef("ocirc",244);this.pushRef("otilde",245);this.pushRef("ouml",246);this.pushRef("divide",247);this.pushRef("oslash",248);this.pushRef("ugrave",249);this.pushRef("uacute",250);this.pushRef("ucirc",251);this.pushRef("uuml",252);this.pushRef("yacute",253);this.pushRef("thorn",254);this.pushRef("yuml",255);this.pushRef("OElig",338);this.pushRef("oelig",339);this.pushRef("Scaron",352);this.pushRef("scaron",353);this.pushRef("Yuml",376);this.pushRef("fnof",402);this.pushRef("circ",710);this.pushRef("tilde",732);this.pushRef("Alpha",913);this.pushRef("Beta",914);this.pushRef("Gamma",915);this.pushRef("Delta",916);this.pushRef("Epsilon",917);this.pushRef("Zeta",918);this.pushRef("Eta",919);this.pushRef("Theta",920);this.pushRef("Iota",921);this.pushRef("Kappa",922);this.pushRef("Lambda",923);this.pushRef("Mu",924);this.pushRef("Nu",925);this.pushRef("Xi",926);this.pushRef("Omicron",927);this.pushRef("Pi",928);this.pushRef("Rho",929);this.pushRef("Sigma",931);this.pushRef("Tau",932);this.pushRef("Upsilon",933);this.pushRef("Phi",934);this.pushRef("Chi",935);this.pushRef("Psi",936);this.pushRef("Omega",937);this.pushRef("alpha",945);this.pushRef("beta",946);this.pushRef("gamma",947);this.pushRef("delta",948);this.pushRef("epsilon",949);this.pushRef("zeta",950);this.pushRef("eta",951);this.pushRef("theta",952);this.pushRef("iota",953);this.pushRef("kappa",954);this.pushRef("lambda",955);this.pushRef("mu",956);this.pushRef("nu",957);this.pushRef("xi",958);this.pushRef("omicron",959);this.pushRef("pi",960);this.pushRef("rho",961);this.pushRef("sigmaf",962);this.pushRef("sigma",963);this.pushRef("tau",964);this.pushRef("upsilon",965);this.pushRef("phi",966);this.pushRef("chi",967);this.pushRef("psi",968);this.pushRef("omega",969);this.pushRef("thetasym",977);this.pushRef("upish",978);this.pushRef("piv",982);this.pushRef("ensp",8194);this.pushRef("emsp",8195);this.pushRef("thinsp",8201);this.pushRef("zwnj",8204);this.pushRef("zwj",8205);this.pushRef("lrm",8206);this.pushRef("rlm",8207);this.pushRef("ndash",8211);this.pushRef("mdash",8212);this.pushRef("lsquo",8216);this.pushRef("rsquo",8217);this.pushRef("sbquo",8218);this.pushRef("ldquo",8220);this.pushRef("rdquo",8221);this.pushRef("bdquo",8222);this.pushRef("dagger",8224);this.pushRef("Dagger",8225);this.pushRef("bull",8226);this.pushRef("hellip",8230);this.pushRef("permil",8240);this.pushRef("prime",8242);this.pushRef("Prime",8243);this.pushRef("lsaquo",8249);this.pushRef("rsaquo",8250);this.pushRef("oline",8254);this.pushRef("frasl",8260);this.pushRef("euro",8364);this.pushRef("image",8465);this.pushRef("weierp",8472);this.pushRef("real",8476);this.pushRef("trade",8482);this.pushRef("alefsym",8501);this.pushRef("larr",8592);this.pushRef("uarr",8593);this.pushRef("rarr",8594);this.pushRef("darr",8595);this.pushRef("harr",8596);this.pushRef("crarr",8629);this.pushRef("lArr",8656);this.pushRef("uArr",8657);this.pushRef("rArr",8658);this.pushRef("dArr",8659);this.pushRef("hArr",8660);this.pushRef("forall",8704);this.pushRef("part",8706);this.pushRef("exist",8707);this.pushRef("empty",8709);this.pushRef("nabla",8711);this.pushRef("isin",8712);this.pushRef("notin",8713);this.pushRef("ni",8715);this.pushRef("prod",8719);this.pushRef("sum",8721);this.pushRef("minus",8722);this.pushRef("lowast",8727);this.pushRef("radic",8730);this.pushRef("prop",8733);this.pushRef("infin",8734);this.pushRef("ang",8736);this.pushRef("and",8743);this.pushRef("or",8744);this.pushRef("cap",8745);this.pushRef("cup",8746);this.pushRef("int",8747);this.pushRef("there4",8756);this.pushRef("sim",8764);this.pushRef("cong",8773);this.pushRef("asymp",8776);this.pushRef("ne",8800);this.pushRef("equiv",8801);this.pushRef("le",8804);this.pushRef("ge",8805);this.pushRef("sub",8834);this.pushRef("sup",8835);this.pushRef("nsub",8836);this.pushRef("sube",8838);this.pushRef("supe",8839);this.pushRef("oplus",8853);this.pushRef("otimes",8855);this.pushRef("perp",8869);this.pushRef("sdot",8901);this.pushRef("lceil",8968);this.pushRef("rceil",8969);this.pushRef("lfloor",8970);this.pushRef("rfloor",8971);this.pushRef("lang",9001);this.pushRef("rang",9002);this.pushRef("loz",9674);this.pushRef("spades",9824);this.pushRef("clubs",9827);this.pushRef("hearts",9829);this.pushRef("diams",9830)};w.EntityRefs.prototype.getRefs=function(){return this.refs};w.EntityRefs.prototype.pushRef=function(e,C){this.refs.push(new w.EntityRef(e,String.fromCharCode(C)))};w.Parser=function(){this.dataType=w.constants.DATATYPE_PARSER;this.isSw8tXmlContent=false;this.doc=new w.Document();this.status=0;this.statusMessage="success";this.xhr=null;this.xhrStatus=null;this.xhrStatusText=null;this.xhrResponseText=null};w.Parser.prototype.getDocument=function(){return this.doc};w.Parser.prototype.getXHR=function(){return this.xhr};w.Parser.prototype.getXHRStatus=function(){return this.xhrStatus};w.Parser.prototype.getXHRStatusText=function(){return this.xhrStatusText};w.Parser.prototype.getXHRResponseText=function(){return this.xhrResponseText};w.Parser.prototype.getStatus=function(){return this.status};w.Parser.prototype.setStatus=function(e){this.status=e};w.Parser.prototype.getStatusMessage=function(){return this.statusMessage};w.Parser.prototype.setStatusMessage=function(e){this.statusMessage=e};w.Parser.prototype.parseProcessingInstructions=function(I,F){var D=new w.Tokenizer(I);var H=D.tokenize();var M=0,Q=0;var R=false;var L,J,N,K,S,G,E;for(var C=0;C<H.length;C++){E=H[C].getType();switch(E){case w.constants.TOKENTYPE_PI_START:M=H[C].getPosition();J="";N=new Array();R=true;J=H[C+1].getContent();C++;break;case w.constants.TOKENTYPE_PI_END:if(R){if(w.Util.isUndefinedNullOrBlank(J)){J="xml"}}R=false;Q=H[C].getPosition()+2;L=new w.ProcessingInstruction(J,N);F.addProcessingInstruction(L);break;case w.constants.TOKENTYPE_ATTRIBUTE:if(R){S=H[C-1].getContent();G=H[C+1].getContent();G=G.slice(1,G.length-1);K=new w.Attribute(S,G);N.push(K)}C++;break;default:break}}if(Q>M){var O=M>0?I.slice(0,M):"";var P=I.slice(Q+1);return w.Util.trim(O+P)}else{return I}};w.Parser.prototype.parseProcessingInstructions=function(I,F){var D=new w.Tokenizer(I);var H=D.tokenize();var M=0,Q=0;var R=false;var L,J,N,K,S,G,E;for(var C=0;C<H.length;C++){E=H[C].getType();switch(E){case w.constants.TOKENTYPE_PI_START:M=H[C].getPosition();J="";N=new Array();R=true;J=H[C+1].getContent();C++;break;case w.constants.TOKENTYPE_PI_END:if(R){if(w.Util.isUndefinedNullOrBlank(J)){J="xml"}}R=false;Q=H[C].getPosition()+2;L=new w.ProcessingInstruction(J,N);F.addProcessingInstruction(L);break;case w.constants.TOKENTYPE_ATTRIBUTE:if(R){S=H[C-1].getContent();G=H[C+1].getContent();G=G.slice(1,G.length-1);K=new w.Attribute(S,G);N.push(K)}C++;break;default:break}}if(Q>M){var O=M>0?I.slice(0,M):"";var P=I.slice(Q+1);return w.Util.trim(O+P)}else{return I}};w.Parser.prototype.parseDOCTYPE=function(H,F){var D=new w.Tokenizer(H);var G=D.tokenize();var I=new w.DOCTYPE();var E,J;try{for(var C=0;C<G.length;C++){E=G[C].getType();switch(E){case w.constants.TOKENTYPE_DOCTYPE_START:if(F){F.setDOCTYPE(I)}if(G[++C].isTagClose()){return I}I.setTopElement(G[C].getContent());J=G[++C].getContent().toUpperCase();I.setAvailability(J);if("SYSTEM"==J){if(G[++C].isTagClose()){return I}I.setURL(G[C].getContent())}else{if("PUBLIC"==J){if(G[++C].isTagClose()){return I}I.setFPI(G[C].getContent());if(G[++C].isTagClose()){return I}I.setURL(G[C].getContent());if(G[++C].isTagClose()){return I}I.setInternalSubset(G[C].getContent())}}break;case w.constants.TOKENTYPE_TAG_CLOSE:return I;default:break}}}catch(K){window.alert(K)}return I};w.Parser.prototype.parse=function(e){this.xhr=null;this.xhrStatus=null;this.xhrStatusText=null;this.xhrResponseText=null;this.doc=new w.Document();this.setStatus(0);e=this.parseProcessingInstructions(e,this.doc);this.parseDOCTYPE(e,this.doc);this.parseElement(e,this.doc);return this.doc};w.Parser.prototype.parseURL=function(D,F,E){var G=new w.SJAX();var C=G.read(D,F,E);this.xhr=G.getRequest();this.xhrStatus=G.getStatus();this.xhrStatusText=G.getStatusText();this.xhrResponseText=G.getResponseText();return C};w.Parser.prototype.parseComment=function(D,G,C){var F=G[C+1].content==w.constants.COMMENT_START?"":G[C+1].content;var E=new w.Comment(F);if(D){D.addContent(E)}C=G[C+1].content==w.constants.COMMENT_START?C+1:C+2;return C};w.Parser.prototype.parseElement=function(F,C,L){var K=new w.Tokenizer(F);var N=K.tokenize();var D=0,U=0;var H=false;for(var P=0;P<N.length;P++){if(N[P].isCommentStart()){P=this.parseComment(L,N,P);continue}for(;P<N.length;P++){if(N[P].isTagOpen()){D=P;break}}if(D!=P){return}var E=new w.Element(N[D+1].content);if(!L){C.setRootElement(E)}else{L.addContent(E)}for(P=D+1;P<N.length;P++){switch(N[P].getType()){case w.constants.TOKENTYPE_SELF_TERMINATING:E.isSelfTerminated=true;D=P;break;case w.constants.TOKENTYPE_TAG_CLOSE:E.isSelfTerminated=false;D=P;break;case w.constants.TOKENTYPE_ATTRIBUTE:try{var X=N[P-1].content;var S=N[P+1].content;var M=S.slice(1,S.length-1);var Q=new w.Attribute(X,M);E.putAttribute(Q)}catch(T){}break;default:break}if(D==P){break}}if(!D==P){return}switch(N[D].content){case w.constants.TAG_CLOSE_SELF_TERMINATING:H=N[D+1]&&N[D+1].content==w.constants.COMMENT_START;if(H){U=D+1;while(H){U=this.parseComment(L,N,U);H=N[U+1]&&N[U+1].content==w.constants.COMMENT_START;if(H){U++}}}else{U=D}break;case w.constants.TAG_CLOSE:if(N[D+1]){if(N[D+1].isCDATAStart()){var O=N[P+2].content;var G=P+3;if(N[P+2].isCDATAEnd()){O="";G=P+2}var Y=new w.CDATA(O);E.addContent(Y);D=G}else{if(N[D+1].isLiteral){E.setText(N[D+1].getContent())}}}else{U=D}for(P=D+1;P<N.length;P++){var J=N[P].getContent()==w.constants.ENDTAG_OPEN&&N[P+1].getContent()==E.getName()?true:false;if(J){U=P;H=N[U+3]&&N[U+3].content==w.constants.COMMENT_START;if(H){U=this.parseComment(L,N,U+3)}var I=U==D+1||(N[D+1].isLiteral&&U==D+2)?false:true;if(!I){break}var V=N[D+1].getPosition();var W=N[U].getPosition();var R=F.slice(V,W);this.parseElement(R,C,E);break}}if(!J){return}break;default:return}P=U}};w.ProcessingInstruction=function(e,C){this.dataType=w.constants.DATATYPE_PROCESSINGINSTRUCTION;this.isSw8tXmlContent=false;this.target=e?e:"xml";if(e&&!C){this.data=new Array()}else{if(!C){this.data=[new w.Attribute("version","1.0"),new w.Attribute("encoding","UTF-8")]}else{this.data=C}}};w.ProcessingInstruction.prototype.getData=function(){return this.data};w.ProcessingInstruction.prototype.setData=function(e){this.data=e};w.ProcessingInstruction.prototype.getTarget=function(){return this.target};w.ProcessingInstruction.prototype.setTarget=function(e){this.target=e};w.ProcessingInstruction.prototype.setAttribute=function(D){var C=this.getData();if(w.Util.dataType(D)==w.constants.DATATYPE_ATTRIBUTE){for(var e=0;e<C.length;e++){if(C[e].getName()==D.getName()){C[e].setValue(D.getValue());return}}}};w.ProcessingInstruction.prototype.getAttributeValue=function(D){var C=this.getData();for(var e=0;e<C.length;e++){if(C[e].getName()==D){return C[e]}}};w.ProcessingInstruction.prototype.setAttributeValue=function(F,D){var E=this.getData();if(F){if(typeof D=="undefined"){D=""}for(var C=0;C<E.length;C++){if(E[C].getName()==F){E[C].setValue(D);return}}E.push(new w.Attribute(F,D))}};w.ProcessingInstruction.prototype.clone=function(){var e=new w.Cloner();return e.cloneProcessingInstruction(this)};w.QName=function(e,C){this.dataType=w.constants.DATATYPE_QNAME;this.isSw8tXmlContent=false;this.prefix=w.Util.nothingToBlank(e);this.localPart=w.Util.nothingToBlank(C)};w.QName.prototype.getName=function(){var e="";if(w.Util.hasValue(this.prefix)){e+=this.prefix+":"}if(w.Util.hasValue(this.localPart)){e+=this.localPart}return e};w.QName.prototype.setName=function(e){var D=w.Util.nothingToBlank(e);var C=D.split(":");if(C.length>1){this.prefix=C[0];this.localPart=C[1]}else{this.prefix="";this.localPart=D}};w.QName.prototype.getPrefix=function(){return w.Util.nothingToBlank(this.prefix)};w.QName.prototype.setPrefix=function(e){this.prefix=w.Util.nothingToBlank(e)};w.QName.prototype.getLocalPart=function(){return w.Util.nothingToBlank(this.localPart)};w.QName.prototype.setLocalPart=function(e){this.localPart=w.Util.nothingToBlank(e)};w.QName.prototype.toString=function(){return this.getName()};w.QName.prototype.clone=function(){var e=new w.Cloner();return e.clone(this)};w.Text=function(e){this.dataType=w.constants.DATATYPE_TEXT;this.isSw8tXmlContent=true;this.text=w.Util.erefEncode(w.Util.nothingToBlank(e))};w.Text.prototype.getText=function(e){if(w.Util.isEmpty(e)){e=true}var C=w.Util.nothingToBlank(this.text);return e?w.Util.erefDecode(C):C};w.Text.prototype.setText=function(e){this.text=w.Util.erefEncode(w.Util.nothingToBlank(e))};w.Text.prototype.toString=function(){return this.getText()};w.Text.prototype.clone=function(){var e=new w.Cloner();return e.clone(this)};w.Token=function(e,C){this.dataType=w.constants.DATATYPE_TOKEN;this.isSwt8XmlContent=false;this.content=typeof(e)=="undefined"?new String():e;this.isLiteral=false;this.position=C?C:0};w.Token.prototype.getContent=function(){return this.content};w.Token.prototype.setContent=function(e){this.content=e};w.Token.prototype.getPosition=function(){return this.position};w.Token.prototype.setPosition=function(e){this.position=e};w.Token.prototype.hasValue=function(){try{return w.Util.hasValue(this.content)}catch(e){return false}};w.Token.prototype.isDOCTYPEStart=function(){return this.content==w.constants.DOCTYPE_START};w.Token.prototype.isPIStart=function(){return this.content==w.constants.PI_START};w.Token.prototype.isPIEnd=function(){return this.content==w.constants.PI_END};w.Token.prototype.isSelfTerminating=function(){return this.content==w.constants.TAG_CLOSE_SELF_TERMINATING};w.Token.prototype.isEndTag=function(){return this.content==w.constants.ENDTAG_OPEN};w.Token.prototype.isCommentStart=function(){return this.content==w.constants.COMMENT_START};w.Token.prototype.isCommentEnd=function(){return this.content==w.constants.COMMENT_END};w.Token.prototype.isAttribute=function(){return this.content==w.constants.EQUALS};w.Token.prototype.isCDATAStart=function(){return this.content==w.constants.CDATA_START};w.Token.prototype.isCDATAEnd=function(){return this.content==w.constants.CDATA_END};w.Token.prototype.isTagOpen=function(){return this.content==w.constants.TAG_OPEN};w.Token.prototype.isTagClose=function(){return this.content==w.constants.TAG_CLOSE};w.Token.prototype.isQuote=function(){return this.content==w.constants.SQUOTE||this.content==w.constants.DQUOTE};w.Token.prototype.isQuoted=function(){return this.content.charAt(0)=='"'&&this.content.charAt(this.content.length-1)=='"'};w.Token.prototype.getType=function(){if(this.isDOCTYPEStart()){return w.constants.TOKENTYPE_DOCTYPE_START}if(this.isPIStart()){return w.constants.TOKENTYPE_PI_START}if(this.isPIEnd()){return w.constants.TOKENTYPE_PI_END}if(this.isSelfTerminating()){return w.constants.TOKENTYPE_SELF_TERMINATING}if(this.isEndTag()){return w.constants.TOKENTYPE_ENDTAG_OPEN}if(this.isCommentStart()){return w.constants.TOKENTYPE_COMMENT_START}if(this.isCommentEnd()){return w.constants.TOKENTYPE_COMMENT_END}if(this.isAttribute()){return w.constants.TOKENTYPE_ATTRIBUTE}if(this.isCDATAStart()){return w.constants.TOKENTYPE_CDATA_START}if(this.isCDATAEnd()){return w.constants.TOKENTYPE_CDATA_END}if(this.isTagOpen()){return w.constants.TOKENTYPE_TAG_OPEN}if(this.isTagClose()){return w.constants.TOKENTYPE_TAG_CLOSE}if(this.isQuote()){return w.constants.TOKENTYPE_QUOTE}if(this.isQuoted()){return w.constants.TOKENTYPE_QUOTED}return w.constants.TOKENTYPE_NORMAL};w.Tokenizer=function(e){this.dataType=w.constants.DATATYPE_TOKENIZER;this.isSw8tXmlContent=false;this.setMarkup(e);this.tokens=new Array()};w.Tokenizer.prototype.getMarkup=function(){return this.markup};w.Tokenizer.prototype.setMarkup=function(e){this.markup=e?e:""};w.Tokenizer.prototype.determineTokenType=function(E,D){var C=this.markup.charAt(E);var F=E>0?this.markup.charAt(E-1):null;if(w.Util.hasWhitespace(C)){return w.constants.TOKENTYPE_WHITESPACE}if(this.markup.slice(E,E+9)==w.constants.DOCTYPE_START){return w.constants.TOKENTYPE_DOCTYPE_START}if(this.markup.slice(E,E+9)==w.constants.CDATA_START){return w.constants.TOKENTYPE_CDATA_START}if(this.markup.slice(E,E+4)==w.constants.COMMENT_START){return w.constants.TOKENTYPE_COMMENT_START}if(this.markup.slice(E,E+3)==w.constants.CDATA_END){return w.constants.TOKENTYPE_CDATA_END}if(this.markup.slice(E,E+2)==w.constants.PI_START){return w.constants.TOKENTYPE_PI_START}if(this.markup.slice(E,E+2)==w.constants.PI_END){return w.constants.TOKENTYPE_PI_END}if(this.markup.slice(E,E+2)==w.constants.TAG_CLOSE_SELF_TERMINATING){return w.constants.TOKENTYPE_SELF_TERMINATING}if(this.markup.slice(E,E+2)==w.constants.ENDTAG_OPEN){return w.constants.TOKENTYPE_ENDTAG_OPEN}if(C==w.constants.EQUALS&&D){return w.constants.TOKENTYPE_ATTRIBUTE}if(C==w.constants.TAG_OPEN){return w.constants.TOKENTYPE_TAG_OPEN}if(C==w.constants.TAG_CLOSE){return w.constants.TOKENTYPE_TAG_CLOSE}if(C==w.constants.SQUOTE){return w.constants.TOKENTYPE_QUOTE}if(C==w.constants.DQUOTE){if(F!==null||F!="\\"){return w.constants.TOKENTYPE_QUOTE}}if(C==w.constants.BRACKET_OPEN){return w.constants.TOKENTYPE_BRACKET_OPEN}return w.constants.TOKENTYPE_NORMAL};w.Tokenizer.prototype.isQuote=function(e){return e==w.constants.SQUOTE||e==w.constants.DQUOTE};w.Tokenizer.prototype.toString=function(){var e=this.tokens;var D=new String();for(var C=0;C<e.length;C++){if(C>0){D+=","}D+=e[C].content}return D};w.Tokenizer.prototype.tokenizeTagContent=function(G,E){var D=false;var H,C;for(var F=E+1;F<this.markup.length;F++){if(this.markup.slice(F,F+9)==w.constants.CDATA_START){D=true;break}else{if(this.markup.charAt(F)==w.constants.TAG_OPEN){break}}}if(D){C=new w.Token(w.constants.CDATA_START,F);G.push(C);C=new w.Token("",F+9);C.isLiteral=true;H=w.constants.CDATA_END;for(E=F+9;E<this.markup.length;E++){if(this.markup.slice(E,E+3)==H){G.push(C);C=new w.Token(H,E);G.push(C);E+=2;C=new w.Token("",E+3);break}else{C.content+=this.markup.charAt(E)}}}else{C=new w.Token("",E+1);C.isLiteral=true}return{token:C,c:E}};w.Tokenizer.prototype.tokenize=function(){var E=new Array();this.tokens=E;var L=new w.Token();var M=false,O=false,K=false;var D,N,P,F;for(var G=0;G<this.markup.length;G++){var C=this.determineTokenType(G,M);switch(C){case w.constants.TOKENTYPE_DOCTYPE_START:O=true;if(L.hasValue()){E.push(L)}L=new w.Token(w.constants.DOCTYPE_START,G);G+=8;break;case w.constants.TOKENTYPE_BRACKET_OPEN:if(O){if(L.hasValue()){E.push(L)}L=new w.Token(this.markup.charAt(G),G);L.isLiteral=true;D=w.constants.BRACKET_CLOSE;for(++G;G<this.markup.length;G++){L.content+=this.markup.charAt(G);if(this.markup.charAt(G)==D){if(L.hasValue()){E.push(L)}L=new w.Token("",G+1);break}}}else{L.content+=this.markup.charAt(G)}break;case w.constants.TOKENTYPE_PI_START:var H;var J="";if(L.hasValue()){E.push(L)}L=new w.Token(w.constants.PI_START,G);E.push(L);N=G+2;M=true;for(G=N;G<this.markup.length;G++){H=this.determineTokenType(G,M);if(H==w.constants.TOKENTYPE_PI_END){J=this.markup.slice(N,G);if(w.Util.isUndefinedNullOrBlank(J)){J="xml"}L=new w.Token(J,G);E.push(L);L=new w.Token(w.constants.PI_END,G);E.push(L);M=false;break}else{if(H==w.constants.TOKENTYPE_WHITESPACE){if(J===""){J=this.markup.slice(N,G);if(w.Util.isUndefinedNullOrBlank(J)){J="xml"}L=new w.Token(J,G);E.push(L)}break}}}L=new w.Token("",G);break;case w.constants.TOKENTYPE_PI_END:L=new w.Token(w.constants.PI_END,G);E.push(L);M=false;G+=2;L=new w.Token("",G);break;case w.constants.TOKENTYPE_WHITESPACE:if(L.isLiteral){L.content+=this.markup.charAt(G);break}for(++G;G<this.markup.length;G++){if(w.Util.hasWhitespace(this.markup.charAt(G))){continue}else{if(L.hasValue()){E.push(L)}C=this.determineTokenType(G,M);if(C==w.constants.TOKENTYPE_NORMAL){P=this.markup.charAt(G);L=new w.Token(P,G)}else{G--;L=new w.Token("",G+1)}break}}break;case w.constants.TOKENTYPE_SELF_TERMINATING:case w.constants.TOKENTYPE_ENDTAG_OPEN:M=false;if(L.hasValue()){E.push(L)}L=new w.Token(this.markup.slice(G,G+2),G);if(L.hasValue()){E.push(L)}G++;L=new w.Token("",G+1);break;case w.constants.TOKENTYPE_TAG_CLOSE:M=false;O=false;if(L.hasValue()){E.push(L)}L=new w.Token(w.constants.TAG_CLOSE,G);E.push(L);var I=this.tokenizeTagContent(E,G);L=I.token;G=I.c;break;case w.constants.TOKENTYPE_ATTRIBUTE:case w.constants.TOKENTYPE_TAG_OPEN:if(this.markup.charAt(G)==w.constants.TAG_OPEN){M=true}if(L.hasValue()){E.push(L)}L=new w.Token(this.markup.charAt(G),G);if(L.hasValue()){E.push(L)}L=new w.Token("",G+1);break;case w.constants.TOKENTYPE_QUOTE:if(L.hasValue()){E.push(L)}L=new w.Token(this.markup.charAt(G),G);L.isLiteral=true;D=this.markup.charAt(G);for(++G;G<this.markup.length;G++){L.content+=this.markup.charAt(G);if(this.markup.charAt(G)==D){if(L.hasValue()){E.push(L)}L=new w.Token("",G+1);break}}break;case w.constants.TOKENTYPE_COMMENT_START:if(L.hasValue()){E.push(L)}L=new w.Token(w.constants.COMMENT_START,G);E.push(L);D=w.constants.COMMENT_END;N=G+4;for(G=N;G<this.markup.length;G++){if(this.markup.slice(G,G+3)==D){F=this.markup.slice(N,G);L=new w.Token(F,N);L.isLiteral=true;E.push(L);L=new w.Token(D,G);E.push(L);G=G+2;break}}L=new w.Token("",G);break;default:L.content+=this.markup.charAt(G);break}}if(L.hasValue()){E.push(L)}return E};w.Util=new Object();w.Util.hasWhitespace=function(F){if(typeof F=="undefined"||F===null){return false}var G=F+"";var D=new RegExp(/^\s+$/);for(var E=0;E<G.length;E++){var C=G.charAt(E);if(D.test(C)){return true}}return false};w.Util.isUndefinedNullOrBlank=function(e){return !w.Util.hasValue(e)};w.Util.isEmpty=w.Util.isUndefinedNullOrBlank;w.Util.nothingToBlank=function(e){return w.Util.isEmpty(e)?"":e};w.Util.isAllWhitespace=function(F){if(typeof(F)=="undefined"||F===null){return false}var C=F+"";for(var E=0;E<C.length;E++){var D=C.charAt(E);if(!w.Util.hasWhitespace(D)){return false}}return true};w.Util.hasValue=function(e){if(typeof e=="undefined"||e===null){return false}var C=e+"";return !(C.length===0||w.Util.isAllWhitespace(C))};w.Util.trim=function(e){var C=e+"";return C.replace(/^\s+|\s+$/g,"")};w.Util.leftTrim=function(e){var C=e+"";return C.replace(/^\s+/,"")};w.Util.rightTrim=function(e){var C=e+"";return C.replace(/\s+$/,"")};w.Util.splitByWhitespace=function(e){if(typeof e=="undefined"||e===null){return e}var C=w.Util.trim(e)+"";return C.split(/\s+/)};w.Util.removeArrayItem=function(D,C){try{for(var e=0;e<D.length;e++){if(e==C){D.splice(e,1)}}}catch(E){}return D};w.Util.dataType=function(e){return typeof e!="undefined"&&e!==null&&e.dataType&&typeof e.dataType=="string"&&e.dataType.length>9&&e.dataType.slice(0,9)=="marknote."?e.dataType:typeof e};w.Util.replaceAll=function(E,C,F){var D=E+"";var G=0;var H="";while(D.indexOf(C,G)!=-1){H+=D.substring(G,D.indexOf(C,G));H+=F;G=(D.indexOf(C,G)+C.length)}H+=E.substring(G,E.length);return H};w.Util.erefEncode=function(e){var C=e+"";return w.Util.erefTransform(C,true)};w.Util.erefXMLEncode=function(e){var C=e+"";return w.Util.erefTransform(C,true,true)};w.Util.erefDecode=function(e){var C=e+"";return w.Util.erefTransform(C,false)};w.Util.erefXMLDecode=function(e){var C=e+"";return w.Util.erefTransform(C,false,true)};w.Util.erefTransform=function(G,D,C){var F=C?new w.XMLEntityRefs().getRefs():new w.EntityRefs().getRefs();var J=new String();J+=G;for(var I=0;I<F.length;I++){var K="&"+F[I].name+";";var L=F[I].character;var E=D?L:K;var H=D?K:L;J=w.Util.replaceAll(J,E,H)}return w.Util.replaceAll(J,"&quot;",'"')};w.Writer=function(){this.dataType=w.constants.DATATYPE_WRITER;this.isSw8tXmlContent=false};w.Writer.prototype.outputDocument=function(C,K){var L=new String();var J=C.getProcessingInstructions();var G=C.getDOCTYPE();for(var M=0;M<J.length;M++){if(M>0){L+="\n"}L+=w.constants.PI_START;var I=J[M];L+=I.getTarget();var F=I.getData();for(var D=0;D<F.length;D++){var H=F[D];L+=" "+H.getName()+'="'+H.getValue()+'"'}L+=" "+w.constants.PI_END}if(G){L+="\n"+G.toString()}var E=C.getRootElement();L+=this.outputElement(E,0,K);return L};w.Writer.prototype.outputElement=function(G,K,H){var I,E,D;I="\n"+this.calculateIndent(K,H)+w.constants.TAG_OPEN+G.getName();for(var C=0;C<G.getAttributes().length;C++){var F=G.getAttributeAt(C);I+=" "+F.getName()+w.constants.EQUALS+w.constants.DQUOTE+F.getValue(false)+w.constants.DQUOTE}if(G.isSelfTerminated||!G.hasContents()){I+=" "+w.constants.TAG_CLOSE_SELF_TERMINATING;return I}I+=w.constants.TAG_CLOSE;if(K===0){K=1}E=this.outputContents(G,K,H);D=G.contents.length==1&&G.getText().length>0&&this.hasStrictText(G)?"":this.calculateIndent(K,H);var J=D+w.constants.ENDTAG_OPEN+G.getName()+w.constants.TAG_CLOSE;return I+E+J};w.Writer.prototype.hasStrictText=function(E){var G=true;for(var C=0;C<E.contents.length;C++){var F=E.getContentAt(C);var D=w.Util.dataType(F);if(D!=w.constants.DATATYPE_TEXT){return false}}return G};w.Writer.prototype.calculateIndent=function(D,C){if(D===0){return""}var E="";C=C&&w.Util.isAllWhitespace(C)?C:"\t";for(var e=1;e<D;e++){E+=C}return E};w.Writer.prototype.outputContents=function(J,M,K){var N=this.calculateIndent(M+1,K);var C=this.calculateIndent(M+2,K);var L=new String();var F="";var D,E,I;for(var G=0;G<J.getContents().length;G++){var H=J.getContentAt(G);F=w.Util.dataType(H);switch(F){case w.constants.DATATYPE_COMMENT:L+="\n"+N+w.constants.COMMENT_START;E=H.getText();I=E.split("\n");for(D=0;D<I.length;D++){L+="\n"+C+w.Util.leftTrim(I[D])}L+="\n"+N+w.constants.COMMENT_END;break;case w.constants.DATATYPE_ELEMENT:L+=this.outputElement(H,M+1,K);break;case w.constants.DATATYPE_TEXT:L+=H.getText(false);break;case w.constants.DATATYPE_CDATA:L+="\n"+N+w.constants.CDATA_START+"\n"+C+H.getText()+"\n"+N+w.constants.CDATA_END;break}}if(F!=w.constants.DATATYPE_TEXT){L+="\n"}return L};var y=function(e){this.xml=e};y.prototype.supports=function(){return false};y.prototype.handle=function(){return[]};var B=function(){y.apply(this,Array.prototype.slice.call(arguments,0))};B.prototype=new y();B.prototype.supports=function(){return this.xml.getRootElement()&&this.xml.getRootElement().getChildElement("rte")};B.prototype.handle=function(){var e,H=0,e,C,K,J=0,G,D=0,E,F,I,L=[];C=this.xml.getRootElement().getChildElements("rte");for(e=C.length;H<e;H++){e=C[H];K=e.getChildElements("rtept");for(G=K.length;J<G;J++){F=K[J].getAttribute("lat").getValue();I=K[J].getAttribute("lon").getValue();L.push({latitude:F,longitude:I})}}return L};var t=function(){y.apply(this,Array.prototype.slice.call(arguments,0))};t.prototype=new y();t.prototype.supports=function(){return this.xml.getRootElement()&&this.xml.getRootElement().getChildElement("trk")};t.prototype.handle=function(){var F,O,H=0,L,D,e,K,C=0,M,E=0,G,I,J,N=[];D=this.xml.getRootElement().getChildElements("trk");for(L=D.length;H<L;H++){O=D[H];K=O.getChildElements("trkseg");for(M=K.length;C<M;C++){F=K[C].getChildElements("trkpt");G=F.length;for(;E<G;E++){I=F[E].getAttribute("lat").getValue();J=F[E].getAttribute("lon").getValue();N.push({latitude:I,longitude:J})}}}return N};v=(new w.Parser()).parse(x.data.data);u=[new t(v),new B(v)];while(z=u.pop()){if(z.supports()){A=z.handle();if(A&&A.length){break}}}self.postMessage(A);self.close()};try{s=new Blob(["self.addEventListener('message', ",o.valueOf(),", false);"])}catch(q){s=new i();s.append("self.addEventListener('message', ");s.append(o.valueOf());s.append(", false);");s=s.getBlob()}l.onload=function(t){r=new Worker(k.createObjectURL(s));r.postMessage({data:t.target.result});r.addEventListener("message",function(v){var u=v.data;if(u&&u.length&&u.length>0){mapController.mapSetup({editMode:true,points:u});g("Map successfully edited.")}else{g("No point found in your gpx file. Map not edited.")}},false)};c.innerHTML="Reading the file...";l.readAsText(p[0])}function h(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect="copy"}})();}

          document.getElementById("bk").href = "javascript:(" + bk.valueOf() + "());";
        </script>

<h3>Testimonials</h3>

<ul>
  <li>Amazing! Works like a sharm! &mdash; <a href="http://support.runkeeper.com/discussions/questions/2878-create-new-race-map-from-activityroute#comment_17209020">Bjornar</a>&nbsp;<ins datetime="2012-08-03">(link broken since last Runkeeper support platform migration)</ins></li>
  <li><ins datetime="2012-08-03">this is phenomenal! I was trying to create a 5.7 mile trail race and it was impossible to get it all correct. Your bookmarklet worked like a champ! Thanks! &mdash; <a href="http://support.runkeeper.com/entries/21704641-editing-a-race-s-map-using-a-gpx-file?page=1#post_21712432">Hollis</a></ins></li>
  <li><ins datetime="2012-09-18">Love the rkrace-bookmarklet! Great for creating race map (!) &mdash; <a href="https://twitter.com/HeatherUrry/status/244604352529043456">@HeatherUrry</a></ins></li>
  <li><ins datetime="2012-09-22">Thanks Valentin. This is super helpful for everyone. Throwing this up on the support home page for everyone to see! &mdash; <a href="http://support.runkeeper.com/entries/21704641-editing-a-race-s-map-using-a-gpx-file?page=1#post_21970628">Chas Wagner (from RunKeeper crew)</a>
  <li><ins datetime="2012-10-02">Awesome work by @jacqueminv in creating a GPX file import bookmarklet for RunKeeper race maps! &mdash; <a href="https://twitter.com/RunKeeper/status/249269548388347904">@RunKeeper</a></ins></li>
  <li><ins datetime="2013-02-14">That tool is really useful, thanks heaps! &mdash; <a href="https://twitter.com/felixmeister/status/301979221981548544">@felixmeister</a></ins></li>
</ul>

<h3>Support or Contact</h3>

<p>Having trouble? Ping me directly on twitter (<a href="https://twitter.com/jacqueminv">@jacqueminv</a>) or fill an <a href="https://github.com/jacqueminv/rkrace-bookmarklet/issues">issue on github</a>.</p>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38498129-1']);
      _gaq.push(['_setDomainName', 'github.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

  </body>
</html>
